import{d as S,g as f,j as U,i as x,c as p,o as w,b as e,t as y,s as $,E as R,A,a as E,p as h,n as I,l as V,r as M,L as N,B as T}from"./islands-BZEcu5Tg.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as W}from"./BaseLink.vue_vue_type_script_setup_true_lang-Dv09fmhI.js";import{b as P,g as j}from"./wsToken-Bm8pUQB5.js";const B={class:"d-flex align-items-center shadow bg-primary page-header"},F={class:"d-flex align-items-center justify-content-between gap-3 w-100 px-4"},D={class:"d-flex align-items-center gap-3"},H={class:"text-white mb-0"},O={class:"d-flex align-items-center gap-3"},z={class:"dropdown"},J={class:"user-chip",type:"button",id:"headerUserMenu","data-bs-toggle":"dropdown","aria-expanded":"false"},X={class:"d-none d-sm-flex flex-column align-items-start lh-1 text-start"},q={class:"text-white fw-semibold"},G={class:"avatar-wrap"},K=["src","alt"],Q={class:"dropdown-menu dropdown-menu-end user-menu shadow-lg"},Y="savenload_avatar_seed_",Z=S({__name:"PageHeader",props:{title:{type:String,default:"Page"},userLabel:{type:String,default:""},userRole:{type:String,default:""}},emits:["profile","settings","logout"],setup(t,{emit:n}){const r=n,u=t,s=f(""),o=f(""),c=f(""),d=f("");typeof window<"u"&&(c.value=window.sessionStorage.getItem("savenload_avatar_seed_label")||"",d.value=window.sessionStorage.getItem("savenload_avatar_seed")||"",d.value&&(s.value=d.value));const i=()=>{const a=crypto?.randomUUID?.()||Math.random().toString(16).slice(2,10),l=Math.floor(Math.random()*1e6);return`${a}-${l}`},_=a=>{if(typeof window>"u")return i();const l=`${Y}${a}`,b=localStorage.getItem(l);if(b&&b!=="undefined")return b;const k=i();return localStorage.setItem(l,k),k};U(()=>u.userLabel,a=>{if(!(a===o.value&&s.value)){if(!a&&d.value){s.value=d.value;return}if(o.value=a,s.value=_(a||"user"),a&&typeof window<"u")try{window.sessionStorage.setItem("savenload_avatar_seed_label",a),window.sessionStorage.setItem("savenload_avatar_seed",s.value),c.value=a,d.value=s.value}catch{}}},{immediate:!0});const m=x(()=>`https://api.dicebear.com/7.x/pixel-art/svg?seed=${encodeURIComponent(s.value||"user")}`),g=x(()=>"User avatar"),v=x(()=>u.userLabel||c.value||"User");return(a,l)=>(w(),p("div",B,[e("div",F,[e("div",D,[l[2]||(l[2]=e("span",{class:"text-white d-lg-none p-0 d-flex align-items-center",role:"button",tabindex:"0","data-bs-toggle":"offcanvas","data-bs-target":"#sidebarMobile","aria-controls":"sidebarMobile","aria-label":"Toggle sidebar"},[e("i",{class:"fas fa-bars fs-3"})],-1)),e("h6",H,y(t.title),1)]),e("div",O,[e("div",z,[e("button",J,[e("div",X,[e("span",q,"Hello, "+y(v.value),1)]),e("div",G,[e("img",{src:m.value,alt:g.value,class:"avatar"},null,8,K)])]),e("ul",Q,[e("li",null,[e("button",{class:"dropdown-item text-white d-flex align-items-center gap-2",type:"button",onClick:l[0]||(l[0]=b=>r("settings"))},[...l[3]||(l[3]=[e("i",{class:"fas fa-cog"},null,-1),$(" Settings ",-1)])])]),e("li",null,[e("button",{class:"dropdown-item text-white d-flex align-items-center gap-2",type:"button",onClick:l[1]||(l[1]=b=>r("logout"))},[...l[4]||(l[4]=[e("i",{class:"fas fa-sign-out-alt"},null,-1),$(" Log Out ",-1)])])])])])])])]))}}),xe=L(Z,[["__scopeId","data-v-04991df5"]]),ee=["id"],te={class:"border-bottom border-secondary d-flex align-items-center justify-content-between p-2 p-md-3 gap-2 gap-md-3 sidebar-header-container"},se={key:0,type:"button",class:"btn-close btn-close-white d-lg-none flex-shrink-0 ms-2","data-bs-dismiss":"offcanvas","aria-label":"Close"},oe={class:"flex-grow-1 overflow-auto mt-3"},ae={class:"list-unstyled mb-0"},ne={class:"mb-2"},le={class:"mb-2"},ie={class:"sidebar-footer border-top px-3 py-3"},re={class:"d-flex align-items-center justify-content-between mb-2"},de={class:"text-white-50 small fw-medium"},ce="/static/images/icon.png",ue=S({__name:"SidebarNav",props:{sidebarId:{type:String,default:"sidebar"},showClose:{type:Boolean,default:!1},versionLabel:{type:String,default:""},onLogout:{type:Function,default:null},onLoadVersion:{type:Function,default:null}},setup(t){const n=t,r=R(n,"versionLabel"),u=f(typeof window<"u"?window.location.pathname:""),s=d=>u.value===d,o=()=>{s("/dashboard")&&window.location.assign("/dashboard")},c=async()=>{if(n.onLogout){await n.onLogout();return}window.location.assign("/")};return A(async()=>{u.value=window.location.pathname,n.onLoadVersion&&await n.onLoadVersion()}),(d,i)=>(w(),p("aside",{id:t.sidebarId,class:"offcanvas offcanvas-start sidebar h-100 d-flex flex-column",tabindex:"-1","aria-labelledby":"sidebarLabel"},[e("div",te,[e("div",{class:"d-flex align-items-center flex-grow-1 min-w-0 gap-2 gap-md-3 sidebar-header-content"},[e("div",{class:"d-flex align-items-center justify-content-center flex-shrink-0 logo-icon"},[e("img",{src:ce,alt:"Save N Load",class:"img-fluid",width:"50",height:"50"})]),i[0]||(i[0]=e("span",{class:"text-white fw-bold text-truncate fs-5 sidebar-header-text"},"Save N Load",-1))]),t.showClose?(w(),p("button",se)):E("",!0)]),e("nav",oe,[e("ul",ae,[e("li",ne,[h(W,{to:"/dashboard","link-class":"sidebar-nav-link d-flex align-items-center text-white text-decoration-none px-3 py-2 rounded",class:I({active:s("/dashboard")}),onClick:o},{default:V(()=>[...i[1]||(i[1]=[e("i",{class:"fas fa-home me-2"},null,-1),e("span",{class:"flex-grow-1"},"Home",-1)])]),_:1},8,["class"])]),e("li",le,[h(W,{to:"/settings","link-class":"sidebar-nav-link d-flex align-items-center text-white text-decoration-none px-3 py-2 rounded",class:I({active:s("/settings")})},{default:V(()=>[...i[2]||(i[2]=[e("i",{class:"fas fa-cog me-2"},null,-1),e("span",{class:"flex-grow-1"},"Settings",-1)])]),_:1},8,["class"])])])]),e("div",ie,[e("div",re,[e("span",de,y(r.value),1)]),e("div",{class:"d-flex align-items-center justify-content-between"},[i[4]||(i[4]=e("div",{class:"text-white-50 small opacity-75"},"Â© 2026 SaveNLoadModern",-1)),e("button",{class:"btn p-0 text-white-50",type:"button",title:"Logout","aria-label":"Logout",onClick:c},[...i[3]||(i[3]=[e("i",{class:"fas fa-sign-out-alt fs-4"},null,-1)])])])])],8,ee))}}),C=L(ue,[["__scopeId","data-v-6fc180f3"]]),fe={class:"d-none d-lg-block"},ve={class:"main-content"},ge={class:"d-lg-none"},me=S({__name:"AppLayout",props:{versionLabel:{type:String,default:""},onLogout:{type:Function,default:null},onLoadVersion:{type:Function,default:null}},setup(t){return(n,r)=>(w(),p("div",null,[e("div",fe,[h(C,{"version-label":t.versionLabel,"on-logout":t.onLogout,"on-load-version":t.onLoadVersion},null,8,["version-label","on-logout","on-load-version"])]),e("div",ve,[M(n.$slots,"default",{},void 0,!0)]),e("div",ge,[h(C,{"sidebar-id":"sidebarMobile","show-close":!0,"version-label":t.versionLabel,"on-logout":t.onLogout,"on-load-version":t.onLoadVersion},null,8,["version-label","on-logout","on-load-version"])])]))}}),ye=L(me,[["__scopeId","data-v-ff00be06"]]),be="http://localhost:8000/api",Se=N("meta",()=>{const t=f("v--");let n=null;const r=o=>o?o.startsWith("v")?o:`v${o}`:"v--";return{versionLabel:t,loadVersion:async()=>{if(n)return n;n=(async()=>{try{const o=await fetch(`${be}/meta/version`,{credentials:"include"});if(!o.ok)return;const c=await o.json();t.value=r(c?.version||"")}catch{}})();try{await n}finally{n=null}},setVersion:o=>{t.value=r(o)}}}),Le=t=>{const n=f(null),r=f(!1),u=f("");let s=null,o=null,c=!0;const d=async()=>t.getWsToken?t.getWsToken():j(),i=()=>{c=!1,o&&(window.clearTimeout(o),o=null),s&&(s.close(),s=null)},_=async g=>{try{const v=JSON.parse(g.data);if(v.type==="worker_status"){const a=v.payload?.connected;n.value=typeof a=="boolean"?a:null;const l=t.suppressRedirectRef?.value??!1;a===!1&&t.onWorkerUnavailable&&!l&&await t.onWorkerUnavailable()}}catch(v){console.error("Worker status WS message error:",v)}},m=async()=>{if(!window.WebSocket||!t.userRef?.value)return;const g=await d();if(!g)return;o&&(window.clearTimeout(o),o=null);const v=P("/ws/ui/worker-status/",{token:g});s=new WebSocket(v),s.addEventListener("open",()=>{r.value=!0}),s.addEventListener("message",_),s.addEventListener("close",()=>{r.value=!1,c&&(o=window.setTimeout(m,3e3))}),s.addEventListener("error",a=>{u.value="Worker status socket error",console.error("Worker status WS error:",a),s?.close()})};return A(m),U(()=>t.userRef?.value,()=>{!s&&t.userRef?.value&&m()}),T(i),{workerAvailable:n,socketOpen:r,lastError:u}};export{ye as A,xe as P,Le as a,Se as u};
