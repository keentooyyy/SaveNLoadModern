import{d as G,c as u,o as l,H as we,b as e,k as _,a as S,l as B,s as C,t as $,I as Oe,q as re,g as x,A as qe,B as ke,j as Ee,F as Z,D as xe,p as L,m as Fe,u as Ne,w as St,J as $t,i as w,n as Ve,f as Ct,e as Tt,E as Lt,h as Re,y as Mt,x as Y,z as _t}from"./islands-BZEcu5Tg.js";import{u as Bt,a as Dt,P as At,A as It}from"./useWorkerStatusSocket-DZgRqAL1.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Se,a as de,p as je,r as We,u as zt}from"./useConfirm-C_IbJmRI.js";import{_ as Gt}from"./TextInput.vue_vue_type_script_setup_true_lang-Bza2zB90.js";import{M as $e}from"./ModalShell-B2LlTyud.js";import{g as Pt}from"./wsToken-Bm8pUQB5.js";import"./BaseLink.vue_vue_type_script_setup_true_lang-Dv09fmhI.js";import"./BaseInput.vue_vue_type_script_setup_true_lang-DuTyusce.js";const Ot=["src","alt"],Ft={class:"position-absolute bottom-0 start-0 end-0 game-card-overlay"},Nt={key:0,class:"text-white-50 d-flex align-items-center mb-2 game-card-footer-text"},Rt={key:1,class:"d-flex gap-2 mt-2"},jt=["disabled"],Wt={key:0,class:"fas fa-spinner fa-spin me-1"},qt={key:1,class:"fas fa-upload me-1"},Et=["disabled"],Vt={key:0,class:"fas fa-spinner fa-spin me-1"},Ut={key:1,class:"fas fa-download me-1"},Ht={class:"text-center w-100"},Qt={key:0,class:"text-white-50 mb-3 small"},Yt={key:1,class:"d-flex gap-2 justify-content-center"},Zt=["disabled"],Jt={key:0,class:"fas fa-spinner fa-spin me-1"},Kt={key:1,class:"fas fa-upload me-1"},Xt=["disabled"],ea={key:0,class:"fas fa-spinner fa-spin me-1"},ta={key:1,class:"fas fa-download me-1"},aa=G({__name:"GameCard",props:{title:{type:String,default:""},footer:{type:String,default:""},image:{type:String,default:""},cardHeight:{type:String,default:"180px"},cardPadding:{type:String,default:"0.5rem"},titleSize:{type:String,default:"0.9rem"},titleMarginBottom:{type:String,default:"0"},footerSize:{type:String,default:"0.75rem"},titleTag:{type:String,default:"h6"},showActions:{type:Boolean,default:!1},saving:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["click","save","load"],setup(a,{emit:c}){const d=c;return(g,r)=>(l(),u("div",{class:"card border-0 shadow h-100 game-card",role:"button",onClick:r[4]||(r[4]=n=>d("click"))},[a.image?(l(),u("div",{key:0,class:"card-img-wrapper position-relative overflow-hidden bg-body game-card-img-wrapper rounded-1",style:we({"--card-height":a.cardHeight,"--card-padding":a.cardPadding,"--card-title-size":a.titleSize,"--card-title-mb":a.titleMarginBottom,"--card-footer-size":a.footerSize})},[e("img",{src:a.image,class:"card-img-top w-100 h-100 game-card-img object-fit-cover",alt:a.title},null,8,Ot),e("div",Ft,[(l(),_(Oe(a.titleTag),{class:"card-title text-white fw-bold game-card-title"},{default:B(()=>[C($(a.title),1)]),_:1})),a.footer?(l(),u("small",Nt,[r[5]||(r[5]=e("i",{class:"fas fa-clock me-1"},null,-1)),C(" "+$(a.footer),1)])):S("",!0),a.showActions?(l(),u("div",Rt,[e("button",{class:"btn btn-sm btn-success flex-fill",type:"button",disabled:a.saving,onClick:r[0]||(r[0]=re(n=>d("save"),["stop"]))},[a.saving?(l(),u("i",Wt)):(l(),u("i",qt)),r[6]||(r[6]=C(" Save ",-1))],8,jt),e("button",{class:"btn btn-sm btn-primary flex-fill",type:"button",disabled:a.loading,onClick:r[1]||(r[1]=re(n=>d("load"),["stop"]))},[a.loading?(l(),u("i",Vt)):(l(),u("i",Ut)),r[7]||(r[7]=C(" Quick Load ",-1))],8,Et)])):S("",!0)])],4)):(l(),u("div",{key:1,class:"card-body d-flex align-items-center justify-content-center bg-body game-card-body-wrapper",style:we({"--card-height":a.cardHeight})},[e("div",Ht,[(l(),_(Oe(a.titleTag),{class:"card-title text-white mb-2"},{default:B(()=>[C($(a.title),1)]),_:1})),a.footer?(l(),u("p",Qt,$(a.footer),1)):S("",!0),a.showActions?(l(),u("div",Yt,[e("button",{class:"btn btn-sm btn-success",type:"button",disabled:a.saving,onClick:r[2]||(r[2]=re(n=>d("save"),["stop"]))},[a.saving?(l(),u("i",Jt)):(l(),u("i",Kt)),r[8]||(r[8]=C(" Save ",-1))],8,Zt),e("button",{class:"btn btn-sm btn-primary",type:"button",disabled:a.loading,onClick:r[3]||(r[3]=re(n=>d("load"),["stop"]))},[a.loading?(l(),u("i",ea)):(l(),u("i",ta)),r[9]||(r[9]=C(" Quick Load ",-1))],8,Xt)])):S("",!0)])],4))]))}}),Ue=P(aa,[["__scopeId","data-v-a59786ad"]]),sa={class:"container-fluid px-4 pt-3 pb-2 position-relative"},na={class:"d-flex align-items-center justify-content-between mb-2"},oa={class:"d-flex gap-2"},la=["disabled"],ia=["disabled"],ra={key:1,class:"d-flex gap-2"},da=G({__name:"RecentList",props:{items:{default:()=>[]},loading:{type:Boolean,default:!1}},emits:["select"],setup(a,{emit:c}){const d=c,g=a,r=x(null),n=x(!1),o=x(!1),m=()=>{const k=r.value;if(!k){n.value=!1,o.value=!1;return}const h=k.scrollWidth-k.clientWidth;n.value=k.scrollLeft>1,o.value=h-k.scrollLeft>1},p=k=>{const h=r.value;if(!h)return;const D=Math.max(200,Math.floor(h.clientWidth*.8));h.scrollBy({left:D*k,behavior:"smooth"})},O=()=>p(-1),ce=()=>p(1),ue=k=>{const h=r.value;!h||h.scrollWidth-h.clientWidth<=0||Math.abs(k.deltaY)<=Math.abs(k.deltaX)||(k.preventDefault(),h.scrollLeft+=k.deltaY)},J=()=>{m()};return qe(()=>{m(),window.addEventListener("resize",J)}),ke(()=>{window.removeEventListener("resize",J)}),Ee(()=>[g.items.length,g.loading],()=>{requestAnimationFrame(()=>m())}),(k,h)=>(l(),u("div",sa,[e("div",na,[h[2]||(h[2]=e("div",{class:"d-flex align-items-center gap-3"},[e("h6",{class:"text-white mb-0 fs-6 fw-medium"},"Recently played games")],-1)),e("div",oa,[e("button",{class:"btn btn-outline-light btn-sm",type:"button","aria-label":"Scroll left",disabled:!n.value,onClick:O},[...h[0]||(h[0]=[e("i",{class:"fas fa-chevron-left"},null,-1)])],8,la),e("button",{class:"btn btn-outline-light btn-sm",type:"button","aria-label":"Scroll right",disabled:!o.value,onClick:ce},[...h[1]||(h[1]=[e("i",{class:"fas fa-chevron-right"},null,-1)])],8,ia)])]),e("div",{ref_key:"scrollContainer",ref:r,class:"d-flex gap-2 overflow-x-auto pb-2 cards-scroll-container scrollbar-thin",onScroll:m,onWheel:ue},[a.loading?(l(),_(Se,{key:0,"wrapper-class":"w-100"})):a.items.length?(l(),u("div",ra,[(l(!0),u(Z,null,xe(a.items,D=>(l(),u("div",{key:D.id,class:"flex-shrink-0 recent-game-card",style:{width:"260px"}},[L(Ue,{title:D.title,footer:D.footer,image:D.image,onClick:Ce=>d("select",D)},null,8,["title","footer","image","onClick"])]))),128))])):(l(),_(de,{key:2,"wrapper-class":"flex-shrink-0 w-100",message:"No recently played games"}))],544)]))}}),ca=P(da,[["__scopeId","data-v-ed2eead2"]]),ua={id:"availableGamesSection",class:"container-fluid px-3 px-md-4 pt-4 pb-5"},ma={class:"d-flex justify-content-between align-items-center mb-4 flex-column flex-md-row gap-3"},fa={id:"gameSearchSortCollapse",class:"collapse d-md-flex gap-2 align-items-center w-100 w-md-auto py-2 py-md-0"},va={class:"d-flex flex-column flex-md-row gap-2 w-100 w-md-auto"},ga={class:"position-relative flex-grow-1"},pa={id:"availableGamesContainer",class:"row g-3"},ba={key:0,class:"col-12"},ha={key:1,class:"col-12"},ya={key:3,class:"col-12"},wa=G({__name:"GameGrid",props:Fe({games:{default:()=>[]},loading:{type:Boolean,default:!1},savingId:{default:null},loadingId:{default:null},searching:{type:Boolean,default:!1}},{search:{default:""},searchModifiers:{},sort:{default:"name_asc"},sortModifiers:{}}),emits:Fe(["search","open","save","load"],["update:search","update:sort"]),setup(a,{emit:c}){const d=c,g=Ne(a,"search"),r=Ne(a,"sort");let n=null;return Ee([g,r],()=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>{d("search",{query:g.value,sort:r.value})},250)}),ke(()=>{n&&window.clearTimeout(n)}),(o,m)=>(l(),u("div",ua,[e("div",ma,[m[4]||(m[4]=e("div",{class:"d-flex justify-content-between align-items-center w-100 w-md-auto"},[e("h4",{class:"text-white mb-0 fw-bold"},"Available games"),e("button",{class:"btn btn-primary d-md-none",type:"button","data-bs-toggle":"collapse","data-bs-target":"#gameSearchSortCollapse","aria-expanded":"false","aria-controls":"gameSearchSortCollapse"},[e("i",{class:"fas fa-filter"}),C(" Filter ")])],-1)),e("div",fa,[e("div",va,[e("div",ga,[L(Gt,{modelValue:g.value,"onUpdate:modelValue":m[0]||(m[0]=p=>g.value=p),placeholder:"Search games...","input-class":"border-secondary pe-5 w-100"},null,8,["modelValue"]),m[2]||(m[2]=e("i",{class:"fas fa-search position-absolute top-50 end-0 translate-middle-y me-3 text-white-50 pointer-events-none"},null,-1))]),St(e("select",{"onUpdate:modelValue":m[1]||(m[1]=p=>r.value=p),class:"form-select bg-primary border-secondary text-white flex-shrink-0 w-auto"},[...m[3]||(m[3]=[e("option",{value:"name_asc"},"Sort: Name (A-Z)",-1),e("option",{value:"name_desc"},"Sort: Name (Z-A)",-1),e("option",{value:"last_saved_desc"},"Sort: Last Saved (Recent)",-1),e("option",{value:"last_saved_asc"},"Sort: Last Saved (Oldest)",-1)])],512),[[$t,r.value]])])])]),e("div",pa,[a.loading?(l(),u("div",ba,[L(Se,{"wrapper-class":"py-5"})])):a.searching?(l(),u("div",ha,[...m[5]||(m[5]=[e("div",{class:"d-flex justify-content-center align-items-center py-4 text-white-50 gap-2"},[e("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),e("span",null,"Searching games...")],-1)])])):(l(!0),u(Z,{key:2},xe(a.games,p=>(l(),u("div",{key:p.id,class:"col-12 col-sm-6 col-md-4 col-lg-3 col-xxl-2"},[L(Ue,{title:p.title,footer:p.footer,image:p.image,"card-height":"320px","card-padding":"1rem","title-size":"1rem","title-margin-bottom":"0.25rem","footer-size":"0.875rem","title-tag":"h5","show-actions":!0,saving:a.savingId===p.id,loading:a.loadingId===p.id,onClick:O=>d("open",p),onSave:O=>d("save",p),onLoad:O=>d("load",p)},null,8,["title","footer","image","saving","loading","onClick","onSave","onLoad"])]))),128)),!a.loading&&!a.games.length?(l(),u("div",ya,[L(de,{"wrapper-class":"py-5",message:"No games available"})])):S("",!0)])]))}}),ka=P(wa,[["__scopeId","data-v-955dd4bd"]]),xa={class:"row g-2 pb-3 mb-3 align-items-stretch d-lg-none"},Sa={class:"col-12 col-md-4"},$a={key:0,class:"col-12 col-md-4"},Ca={key:1,class:"col-12 col-md-4"},Ta={class:"d-none d-lg-flex align-items-stretch justify-content-between gap-2 pb-3 mb-3"},La={class:"flex-grow-0 saves-actions-left"},Ma={key:0,class:"d-flex gap-2 align-items-stretch saves-actions-right"},_a=G({__name:"SaveActionsBar",props:{loading:{type:Boolean,default:!1},hasSaves:{type:Boolean,default:!1}},emits:["open-location","backup-all","delete-all"],setup(a,{emit:c}){const d=a,g=c,r=w(()=>!d.loading&&d.hasSaves);return(n,o)=>(l(),u(Z,null,[e("div",xa,[e("div",Sa,[e("button",{class:"btn btn-info text-white btn-sm w-100 text-center saves-action-btn",type:"button",onClick:o[0]||(o[0]=m=>g("open-location"))},[...o[6]||(o[6]=[e("i",{class:"fas fa-folder-open me-2"},null,-1),e("span",{class:"saves-action-label"},"Open Save Location",-1)])])]),r.value?(l(),u("div",$a,[e("button",{class:"btn btn-secondary text-white btn-sm w-100 text-center saves-action-btn",type:"button",onClick:o[1]||(o[1]=m=>g("backup-all"))},[...o[7]||(o[7]=[e("i",{class:"fas fa-download me-2"},null,-1),e("span",{class:"saves-action-label"},"Backup All Saves",-1)])])])):S("",!0),r.value?(l(),u("div",Ca,[e("button",{class:"btn btn-danger text-white btn-sm w-100 text-center saves-action-btn",type:"button",onClick:o[2]||(o[2]=m=>g("delete-all"))},[...o[8]||(o[8]=[e("i",{class:"fas fa-trash me-2"},null,-1),e("span",{class:"saves-action-label"},"Delete Older Saves",-1)])])])):S("",!0)]),e("div",Ta,[e("div",La,[e("button",{class:"btn btn-info text-white btn-sm text-center saves-action-btn",type:"button",onClick:o[3]||(o[3]=m=>g("open-location"))},[...o[9]||(o[9]=[e("i",{class:"fas fa-folder-open me-2"},null,-1),e("span",{class:"saves-action-label"},"Open Save Location",-1)])])]),r.value?(l(),u("div",Ma,[e("button",{class:"btn btn-secondary text-white btn-sm text-center saves-action-btn",type:"button",onClick:o[4]||(o[4]=m=>g("backup-all"))},[...o[10]||(o[10]=[e("i",{class:"fas fa-download me-2"},null,-1),e("span",{class:"saves-action-label"},"Backup All Saves",-1)])]),e("button",{class:"btn btn-danger text-white btn-sm text-center saves-action-btn",type:"button",onClick:o[5]||(o[5]=m=>g("delete-all"))},[...o[11]||(o[11]=[e("i",{class:"fas fa-trash me-2"},null,-1),e("span",{class:"saves-action-label"},"Delete Older Saves",-1)])])])):S("",!0)])],64))}}),Ba=P(_a,[["__scopeId","data-v-75d3512c"]]),Da={class:"list-group-item bg-primary text-white border-secondary transition-bg list-group-item-hover rounded-3 border border-secondary bg-opacity-10 p-3"},Aa={class:"d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center gap-2"},Ia={class:"w-100"},za={class:"mb-1 text-white"},Ga={class:"text-white-50"},Pa={class:"d-flex flex-column flex-sm-row gap-2 saves-item-actions"},Oa=G({__name:"SaveFolderItem",props:{folder:{type:Object,required:!0}},emits:["load","delete"],setup(a,{emit:c}){const d=c,g=r=>{if(!r)return"";const n=new Date(r);if(Number.isNaN(n.getTime()))return r;const o=n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),m=n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return`${o} ${m}`};return(r,n)=>(l(),u("div",Da,[e("div",Aa,[e("div",Ia,[e("h6",za,"Save "+$(a.folder.folder_number),1),e("small",Ga,$(g(a.folder.created_at)),1)]),e("div",Pa,[e("button",{class:"btn btn-sm btn-secondary text-white saves-item-btn",type:"button",onClick:n[0]||(n[0]=o=>d("load",a.folder))},[...n[2]||(n[2]=[e("i",{class:"fas fa-download me-1"},null,-1),C(" Load ",-1)])]),e("button",{class:"btn btn-sm btn-outline-danger text-white saves-item-btn",type:"button",onClick:n[1]||(n[1]=o=>d("delete",a.folder))},[...n[3]||(n[3]=[e("i",{class:"fas fa-trash me-1"},null,-1),C(" Delete ",-1)])])])])]))}}),Fa=P(Oa,[["__scopeId","data-v-eb27bd7f"]]),Na={class:"modal-header modal-shell__header"},Ra={class:"d-flex flex-column gap-1"},ja={key:0},Wa={key:0,class:"text-uppercase text-white-50 small"},qa={class:"modal-body modal-shell__body overflow-auto",style:{"max-height":"70vh"}},Ea={key:3,class:"d-grid gap-2"},Va={key:0,class:"d-flex gap-2 modal-footer-admin"},Ua=G({__name:"GameSavesModal",props:{open:{type:Boolean,default:!1},title:{type:String,default:""},saveFolders:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:""},isAdmin:{type:Boolean,default:!1}},emits:["load","delete","backup-all","delete-all","open-location","edit-game","delete-game","close"],setup(a,{emit:c}){const d=c,g=`gameSavesModalLabel_${Math.random().toString(36).slice(2,8)}`;return(r,n)=>(l(),_($e,{open:a.open,show:a.open,"labelled-by":g,"dialog-class":"modal-lg",onBackdrop:n[7]||(n[7]=o=>d("close"))},{header:B(()=>[e("div",Na,[e("div",Ra,[e("h5",{class:"modal-title text-white",id:g},[n[8]||(n[8]=C(" Available Saves",-1)),a.title?(l(),u("span",ja," Â· "+$(a.title),1)):S("",!0)]),a.loading?S("",!0):(l(),u("small",Wa,$(a.saveFolders.length)+" saved",1))]),e("button",{type:"button",class:"btn-close btn-close-white","aria-label":"Close",onClick:n[0]||(n[0]=o=>d("close"))})])]),body:B(()=>[e("div",qa,[L(Ba,{loading:a.loading,"has-saves":!!a.saveFolders.length,onOpenLocation:n[1]||(n[1]=o=>d("open-location")),onBackupAll:n[2]||(n[2]=o=>d("backup-all")),onDeleteAll:n[3]||(n[3]=o=>d("delete-all"))},null,8,["loading","has-saves"]),a.loading?(l(),_(Se,{key:0,message:"Loading saves...","spinner-class":"text-secondary"})):a.error?(l(),_(de,{key:1,message:a.error},null,8,["message"])):a.saveFolders.length?(l(),u("div",Ea,[(l(!0),u(Z,null,xe(a.saveFolders,o=>(l(),_(Fa,{key:o.folder_number,folder:o,onLoad:m=>d("load",o),onDelete:m=>d("delete",o)},null,8,["folder","onLoad","onDelete"]))),128))])):(l(),_(de,{key:2,message:"No saves available"}))])]),footer:B(()=>[e("div",{class:Ve(["modal-footer modal-shell__footer d-flex align-items-center",a.isAdmin?"justify-content-between":"justify-content-end"])},[a.isAdmin?(l(),u("div",Va,[e("button",{type:"button",class:"btn btn-outline-secondary text-white modal-footer-btn",onClick:n[4]||(n[4]=o=>d("edit-game"))},[...n[9]||(n[9]=[e("i",{class:"fas fa-edit me-1"},null,-1),C(" Edit ",-1)])]),e("button",{type:"button",class:"btn btn-outline-danger text-white modal-footer-btn",onClick:n[5]||(n[5]=o=>d("delete-game"))},[...n[10]||(n[10]=[e("i",{class:"fas fa-trash me-1"},null,-1),C(" Delete ",-1)])])])):S("",!0),e("button",{type:"button",class:"btn btn-outline-secondary text-white modal-footer-btn",onClick:n[6]||(n[6]=o=>d("close"))}," Close ")],2)]),_:1},8,["open","show"]))}}),Ha=P(Ua,[["__scopeId","data-v-112a7104"]]),Qa={class:"modal-header modal-shell__header"},Ya={class:"modal-body modal-shell__body"},Za={class:"operation-progress"},Ja={class:"operation-progress-track"},Ka={class:"d-flex justify-content-between align-items-center mt-2"},Xa={class:"text-white fw-medium"},es={class:"text-white-50 small"},ts={key:0,class:"text-white-50 small mt-2 mb-0"},as=G({__name:"OperationProgressModal",props:{open:{type:Boolean,default:!1},title:{type:String,default:"Operation in progress"},subtitle:{type:String,default:"Please keep this window open."},statusText:{type:String,default:"Preparing..."},detail:{type:String,default:"Working on your request."},progress:{type:Number,default:0},variant:{type:String,default:"info"},closable:{type:Boolean,default:!1}},emits:["close"],setup(a,{emit:c}){const d=a,g=c,r=`operationModalTitle_${Math.random().toString(36).slice(2,8)}`,n=w(()=>d.variant==="success"?"is-success":d.variant==="danger"?"is-danger":d.variant==="warning"?"is-warning":"is-info"),o=()=>{d.closable&&g("close")};return(m,p)=>(l(),_($e,{open:a.open,show:a.open,"labelled-by":r,"modal-class":"operation-progress-modal","backdrop-class":"operation-progress-backdrop","dialog-class":"operation-modal-dialog",onBackdrop:o},{header:B(()=>[e("header",Qa,[e("h5",{id:r,class:"mb-0"},$(a.title),1),a.closable?(l(),u("button",{key:0,class:"btn-close btn-close-white ms-auto",type:"button","aria-label":"Close",onClick:o})):S("",!0)])]),body:B(()=>[e("div",Ya,[e("div",Za,[e("div",Ja,[e("div",{class:Ve(["operation-progress-bar",n.value]),style:we({width:`${a.progress}%`})},null,6)]),e("div",Ka,[e("span",Xa,$(a.statusText),1),e("span",es,$(Math.round(a.progress))+"%",1)]),a.detail?(l(),u("p",ts,$(a.detail),1)):S("",!0)])])]),_:1},8,["open","show"]))}}),ss=P(as,[["__scopeId","data-v-815b284a"]]),ns={class:"modal-body modal-shell__body"},os={class:"card bg-dark border-secondary mb-3"},ls={class:"card-body py-2"},is={class:"text-info d-block backup-modal-path"},rs={class:"modal-footer modal-shell__footer d-flex justify-content-end"},ds=G({__name:"BackupCompleteModal",props:{open:{type:Boolean,default:!1},zipPath:{type:String,default:""}},emits:["close","open-location"],setup(a,{emit:c}){const d=a,g=c,r=`backupModalTitle_${Math.random().toString(36).slice(2,8)}`,n=()=>{g("close")},o=()=>{d.zipPath&&g("open-location")};return(m,p)=>(l(),_($e,{open:a.open,show:a.open,"labelled-by":r,"modal-class":"backup-complete-modal","backdrop-class":"backup-complete-backdrop","dialog-style":"max-width: 520px;"},{header:B(()=>[e("div",{class:"modal-header modal-shell__header"},[e("div",{class:"d-flex flex-column gap-1"},[e("h5",{id:r,class:"modal-title text-white mb-0"},"Backup Complete")]),e("button",{class:"btn-close btn-close-white",type:"button","aria-label":"Close",onClick:n})])]),body:B(()=>[e("div",ns,[p[1]||(p[1]=e("p",{class:"text-white mb-3"},"Your backup has been saved successfully.",-1)),e("div",os,[e("div",ls,[p[0]||(p[0]=e("small",{class:"text-white-50 d-block mb-1"},"File Location",-1)),e("code",is,$(a.zipPath),1)])])])]),footer:B(()=>[e("div",rs,[e("button",{class:"btn btn-outline-secondary text-white",type:"button",onClick:n},"Close"),a.zipPath?(l(),u("button",{key:0,class:"btn btn-light text-primary",type:"button",onClick:o}," Open Folder ")):S("",!0)])]),_:1},8,["open","show"]))}}),cs=P(ds,[["__scopeId","data-v-03d11a16"]]),us={class:"container-fluid px-0"},ms={key:0,class:"alert alert-danger mx-3 mt-3"},fs={key:1,class:"alert alert-warning mx-3 mt-3"},vs=G({__name:"DashboardPage",setup(a){const c=Ct(),d=Tt(),g=Bt(),{requestConfirm:r}=zt(),n=Lt(d,"suppressWorkerRedirect"),o=x(""),m=x("name_asc"),p=w(()=>c.games),O=w(()=>c.recentGames),ce=w(()=>c.loading&&O.value.length===0),ue=w(()=>c.loading&&p.value.length===0),J=w(()=>c.isAdmin),k=w(()=>c.error),h=w(()=>c.user?.username||d.user?.username||""),D=w(()=>(c.user?.role||d.user?.role||"").toUpperCase()),Ce=w(()=>g.versionLabel),W=w(()=>{const t=c.user?.guest_expires_at||d.user?.guest_expires_at;return t?new Date(t):null}),He=w(()=>!!(c.user?.is_guest??d.user?.is_guest)&&W.value),Qe=w(()=>d.user?.guest_migration_status==="migrating"),me=x(Date.now());let K=null;const X=x(""),y=x(null),A=x(!1),q=x([]),fe=x(!1),ee=x(""),te=x(null),ae=x(null),ve=x(!1);let Te=0;const i=Re({open:!1,title:"Operation in progress",subtitle:"This can take a minute. Keep this window open.",statusText:"Preparing...",detail:"We are syncing your data.",progress:0,variant:"info",closable:!1,pauseToken:null}),b=Re({open:!1,zipPath:"",gameId:null,pending:!1,pauseToken:null}),E=x(!1);let se=null,V=null;const Ye=w(()=>W.value?W.value.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):""),Ze=w(()=>{if(!W.value)return"";const t=W.value.getTime()-me.value;if(t<=0)return"expired";const s=Math.ceil(t/(1e3*60*60*24));return`${s} day${s===1?"":"s"}`}),F=()=>{if(!Qe.value)return!0;const t=window.toastr;return t?.info&&t.info("Guest migration in progress. Save/load is temporarily disabled."),!1},Le=()=>{se!==null&&(window.clearTimeout(se),se=null)},ne=()=>{V!==null&&(window.clearTimeout(V),V=null)},M=t=>{const s=t?.status;s===401?window.location.assign("/login"):s===503&&window.location.assign("/worker-required")},Je=(t,s,f)=>{Le(),A.value&&(E.value=!0,A.value=!1),i.pauseToken||(i.pauseToken=je()),i.open=!0,i.title=t,i.subtitle=s,i.detail=f,i.statusText="Starting...",i.progress=0,i.variant="info",i.closable=!1},ge=()=>{if(Le(),i.open=!1,We(i.pauseToken),i.pauseToken=null,b.pending){b.pending=!1,b.open=!0,ne(),V=window.setTimeout(()=>{b.open&&oe()},6e3);return}E.value&&!b.open&&(A.value=!0,E.value=!1)},oe=()=>{ne(),b.open=!1,We(b.pauseToken),b.pauseToken=null,E.value&&!i.open&&(A.value=!0,E.value=!1)},Ke=()=>{A.value=!1},le=t=>{if(!t)return"";const s="Backup saved to:",f=t.indexOf(s);return(f>=0?t.slice(f+s.length):t).trim().replace(/^["']|["']$/g,"")},Xe=(t,s)=>{b.zipPath=le(t),b.gameId=s,b.pending=!0,i.open||(b.pending=!1,b.pauseToken||(b.pauseToken=je()),b.open=!0,ne(),V=window.setTimeout(()=>{b.open&&oe()},6e3))},et=t=>{const s=t.toLowerCase();return s.includes("backup")||s.includes("backing up")||s.includes("back up")},Me=t=>{if(!t)return!1;const s=t.toLowerCase();return s.includes("save directory is empty")||s.includes("no files to save")||s.includes("don't have any save files")},tt=t=>{const f=(t?.data??t)?.result_data;if(f?.zip_path)return le(f.zip_path);const T=f?.message||"";return typeof T=="string"?le(T):""},N=t=>t?Array.isArray(t.operation_ids)?t.operation_ids:t.operation_id?[t.operation_id]:[]:[],at=t=>t?t.percentage!==void 0&&t.percentage!==null?Number(t.percentage):t.total&&t.current!==void 0?Math.round(Number(t.current)/Number(t.total)*100):null:null,R=async(t,s,f,T)=>{const De=t.filter(Boolean);if(De.length===0)return;Je(s,"Working on your request.",f);const yt=300;let Ae=0,ie=!1,wt=!1;for(;!ie&&Ae<yt;){Ae+=1;try{const I=await Promise.all(De.map(async v=>{try{const z=await c.checkOperationStatus(v);return z?.data||z}catch{return{failed:!0}}})),U=I.length,be=I.filter(v=>v?.completed).length,H=I.filter(v=>v?.failed).length,kt=be+H,he=I.map(v=>at(v?.progress)).filter(v=>typeof v=="number");if(he.length>0){const v=Math.round(he.reduce((z,j)=>z+j,0)/he.length);i.progress=Math.min(100,Math.max(0,v))}else i.progress=Math.round(be/U*100);const Ie=I.map(v=>v?.progress?.message||v?.message).find(v=>v),ze=I.map(v=>v?.message||v?.result_data?.message).find(v=>v),xt=Me(Ie||"")?"":Ie||"Processing...";if(i.statusText=xt||"Processing...",i.detail=`${be}/${U} completed`,kt===U){if(ie=!0,H===0){const v=ze||"";i.variant="success",i.statusText=ze||"All operations complete",i.detail=v,v&&Y.success(v);const z=s.toLowerCase(),j=et(s);if(z.includes("save")&&!j)try{await c.loadDashboard()}catch{}if(j){let Q="";const Ge=I.find(Pe=>Pe?.result_data?.zip_path);if(Ge?.result_data?.zip_path)Q=Ge.result_data.zip_path;else try{Q=(await Promise.all(t.map(async ye=>c.checkOperationStatus(ye)))).map(tt).find(ye=>ye)||""}catch{Q=""}Q&&Xe(Q,y.value)}if(T)try{await T()}catch{}se=window.setTimeout(()=>{i.open&&i.variant==="success"&&ge()},1500)}else if(H<U)i.variant="warning",i.statusText="Partially complete",i.detail=`${U-H} succeeded, ${H} failed.`;else{const v=I.find(j=>j?.message)?.message||"";i.variant="danger",i.statusText="Operation failed";const z=Me(v);i.detail=z?"":v,Y.error(v||"Operation failed."),wt=!0,z&&ge()}i.progress=100,i.closable=!0}else await new Promise(v=>setTimeout(v,1e3))}catch{i.variant="danger",i.statusText="Operation failed",i.detail="",i.progress=100,i.closable=!0,ie=!0}}ie||(i.variant="warning",i.statusText="Still running",i.detail="This is taking longer than expected. You can close this and check later.",i.progress=Math.min(i.progress,99),i.closable=!0)},st=async({query:t,sort:s})=>{const f=++Te;ve.value=!0;try{await c.searchGames(t,s)}catch(T){await M(T)}finally{f===Te&&(ve.value=!1)}},nt=()=>{const t=document.getElementById("availableGamesSection");t&&t.scrollIntoView({behavior:"smooth",block:"start"})},ot=async t=>{const s=t?.title?.trim()||"";s&&(o.value===s&&(o.value="",await Mt()),o.value=s,nt())},lt=t=>{X.value=t?.title||"",y.value=t?.id||null,pe(),A.value=!0},it=async t=>{if(F())try{te.value=t.id;const s=await c.saveGame(t.id),f=N(s);await R(f,"Saving game",`Saving ${t?.title||"game"}...`,()=>c.touchRecentGame(t.id))}catch(s){await M(s)}finally{te.value===t.id&&(te.value=null)}},rt=async t=>{if(F())try{ae.value=t.id;const s=await c.loadGame(t.id),f=N(s);await R(f,"Loading game",`Loading ${t?.title||"game"}...`)}catch(s){await M(s)}finally{ae.value===t.id&&(ae.value=null)}},_e=()=>window.location.assign("/settings"),dt=()=>window.location.assign("/settings"),Be=async()=>{try{await d.logout()}catch{}finally{window.location.assign("/")}},ct=async()=>{await g.loadVersion()};Dt({userRef:w(()=>d.user),suppressRedirectRef:n,getWsToken:()=>Pt(),onWorkerUnavailable:()=>{window.location.assign("/worker-required")}});const pe=async()=>{if(!y.value){q.value=[],ee.value="";return}fe.value=!0,ee.value="",q.value=[];try{const t=await c.listSaveFolders(y.value);q.value=t?.save_folders||[]}catch(t){ee.value=t?.message||""}finally{fe.value=!1}},ut=async t=>{if(F()&&y.value)try{const s=await c.loadGameSaveFolder(y.value,t.folder_number),f=N(s);await R(f,"Loading game",`Loading save ${t.folder_number}...`)}catch(s){await M(s)}},mt=async t=>{if(!(!F()||!y.value||!await r({title:"Delete Save",message:`Delete save ${t.folder_number}? This cannot be undone.`,confirmText:"Delete",variant:"danger"})))try{const f=await c.deleteSaveFolder(y.value,t.folder_number),T=N(f);await R(T,"Deleting save",`Deleting save ${t.folder_number}...`,pe)}catch(f){await M(f)}},ft=async()=>{if(F()&&y.value)try{const t=await c.backupAllSaves(y.value),s=N(t);await R(s,"Backing up saves","Creating backup...")}catch(t){await M(t)}},vt=async()=>{if(!(!F()||!y.value||!await r({title:"Delete Older Saves",message:"Delete older saves for this game? The latest save will be kept.",confirmText:"Delete",variant:"danger"})))try{const s=await c.deleteAllSaves(y.value),f=N(s);await R(f,"Deleting saves","Deleting older saves...",pe)}catch(s){await M(s),s?.message&&Y.error(s.message)}},gt=async()=>{if(F()&&y.value)try{const t=await c.openSaveLocation(y.value);t?.message&&Y.success(t.message)}catch(t){await M(t)}},pt=async()=>{if(!(!y.value||!await r({title:"Delete Game",message:"Delete this game and all its saves? This cannot be undone.",confirmText:"Delete",variant:"danger"})))try{const s=await c.deleteGame(y.value),f=N(s);A.value=!1;const T=()=>{y.value=null,X.value="",q.value=[]};f.length?await R(f,"Deleting game",`Deleting ${X.value||"game"}...`,async()=>{T(),await c.loadDashboard()}):(T(),await c.loadDashboard())}catch(s){await M(s)}},bt=async()=>{const t=le(b.zipPath);if(!(!t||!b.gameId))try{const s=await c.openBackupLocation(b.gameId,t);s?.message&&Y.success(s.message),oe()}catch(s){await M(s)}},ht=()=>{y.value&&(A.value=!1,window.location.assign(`/games/${y.value}`))};return qe(async()=>{me.value=Date.now(),K=window.setInterval(()=>{me.value=Date.now()},6e4);try{await d.refreshUser(),await c.loadDashboard()}catch(t){await M(t)}}),ke(()=>{ne(),K&&(clearInterval(K),K=null)}),(t,s)=>(l(),u(Z,null,[L(It,{"version-label":Ce.value,"on-logout":Be,"on-load-version":ct},{default:B(()=>[e("div",us,[L(At,{title:"Home","user-label":h.value,"user-role":D.value,onProfile:dt,onSettings:_e,onLogout:Be},null,8,["user-label","user-role"]),k.value?(l(),u("div",ms,$(k.value),1)):S("",!0),He.value?(l(),u("div",fs,[C(" Guest account will be deleted on "+$(Ye.value)+" ("+$(Ze.value)+" left). ",1),e("button",{class:"btn btn-sm btn-dark ms-2",onClick:_e},"Upgrade Account")])):S("",!0),L(ca,{items:O.value,loading:ce.value,onSelect:ot},null,8,["items","loading"]),L(ka,{search:o.value,"onUpdate:search":s[0]||(s[0]=f=>o.value=f),sort:m.value,"onUpdate:sort":s[1]||(s[1]=f=>m.value=f),games:p.value,loading:ue.value,"saving-id":te.value,"loading-id":ae.value,searching:ve.value,onSearch:st,onOpen:lt,onSave:it,onLoad:rt},null,8,["search","sort","games","loading","saving-id","loading-id","searching"])])]),_:1},8,["version-label"]),L(Ha,{open:A.value,title:X.value,"save-folders":q.value,loading:fe.value,error:ee.value,"is-admin":J.value,onClose:Ke,onLoad:ut,onDelete:mt,onBackupAll:ft,onDeleteAll:vt,onOpenLocation:gt,onEditGame:ht,onDeleteGame:pt},null,8,["open","title","save-folders","loading","error","is-admin"]),L(ss,{open:i.open,title:i.title,subtitle:i.subtitle,"status-text":i.statusText,detail:i.detail,progress:i.progress,variant:i.variant,closable:i.closable,onClose:ge},null,8,["open","title","subtitle","status-text","detail","progress","variant","closable"]),L(cs,{open:b.open,"zip-path":b.zipPath,onClose:oe,onOpenLocation:bt},null,8,["open","zip-path"])],64))}});_t("dashboard",vs);
