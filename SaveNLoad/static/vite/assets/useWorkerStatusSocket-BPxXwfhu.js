import{d as L,g as v,j as V,i as k,c as S,o as x,b as e,t as g,s as E,E as N,A as W,a as P,p as _,n as M,l as y,h as j,k as F,L as f,r as q,M as D,B as H}from"./islands-CvRdAtFP.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as I}from"./BaseLink.vue_vue_type_script_setup_true_lang-Cq0V9m-h.js";import{M as O}from"./ModalShell-CppTqaMo.js";import{b as z,g as J}from"./wsToken-mbUjdKxf.js";const X={class:"d-flex align-items-center shadow bg-primary page-header"},G={class:"d-flex align-items-center justify-content-between gap-3 w-100 px-4"},K={class:"d-flex align-items-center gap-3"},Q={class:"text-white mb-0"},Y={class:"d-flex align-items-center gap-3"},Z={class:"dropdown"},ee={class:"user-chip",type:"button",id:"headerUserMenu","data-bs-toggle":"dropdown","aria-expanded":"false"},te={class:"d-none d-sm-flex flex-column align-items-start lh-1 text-start"},se={class:"text-white fw-semibold"},oe={class:"avatar-wrap"},ae=["src","alt"],ne={class:"dropdown-menu dropdown-menu-end user-menu shadow-lg"},le="savenload_avatar_seed_",re=L({__name:"PageHeader",props:{title:{type:String,default:"Page"},userLabel:{type:String,default:""},userRole:{type:String,default:""}},emits:["profile","settings","logout"],setup(t,{emit:s}){const a=s,r=t,o=v(""),n=v(""),m=v(""),d=v("");typeof window<"u"&&(m.value=window.sessionStorage.getItem("savenload_avatar_seed_label")||"",d.value=window.sessionStorage.getItem("savenload_avatar_seed")||"",d.value&&(o.value=d.value));const l=()=>{const i=crypto?.randomUUID?.()||Math.random().toString(16).slice(2,10),c=Math.floor(Math.random()*1e6);return`${i}-${c}`},C=i=>{if(typeof window>"u")return l();const c=`${le}${i}`,w=localStorage.getItem(c);if(w&&w!=="undefined")return w;const T=l();return localStorage.setItem(c,T),T};V(()=>r.userLabel,i=>{if(!(i===n.value&&o.value)){if(!i&&d.value){o.value=d.value;return}if(n.value=i,o.value=C(i||"user"),i&&typeof window<"u")try{window.sessionStorage.setItem("savenload_avatar_seed_label",i),window.sessionStorage.setItem("savenload_avatar_seed",o.value),m.value=i,d.value=o.value}catch{}}},{immediate:!0});const h=k(()=>`https://api.dicebear.com/7.x/pixel-art/svg?seed=${encodeURIComponent(o.value||"user")}`),b=k(()=>"User avatar"),p=k(()=>r.userLabel||m.value||"User");return(i,c)=>(x(),S("div",X,[e("div",G,[e("div",K,[c[2]||(c[2]=e("span",{class:"text-white d-lg-none p-0 d-flex align-items-center",role:"button",tabindex:"0","data-bs-toggle":"offcanvas","data-bs-target":"#sidebarMobile","aria-controls":"sidebarMobile","aria-label":"Toggle sidebar"},[e("i",{class:"fas fa-bars fs-3"})],-1)),e("h6",Q,g(t.title),1)]),e("div",Y,[e("div",Z,[e("button",ee,[e("div",te,[e("span",se,"Hello, "+g(p.value),1)]),e("div",oe,[e("img",{src:h.value,alt:b.value,class:"avatar"},null,8,ae)])]),e("ul",ne,[e("li",null,[e("button",{class:"dropdown-item text-white d-flex align-items-center gap-2",type:"button",onClick:c[0]||(c[0]=w=>a("settings"))},[...c[3]||(c[3]=[e("i",{class:"fas fa-cog"},null,-1),E(" Settings ",-1)])])]),e("li",null,[e("button",{class:"dropdown-item text-white d-flex align-items-center gap-2",type:"button",onClick:c[1]||(c[1]=w=>a("logout"))},[...c[4]||(c[4]=[e("i",{class:"fas fa-sign-out-alt"},null,-1),E(" Log Out ",-1)])])])])])])])]))}}),qe=$(re,[["__scopeId","data-v-04991df5"]]),ie=["id"],de={class:"border-bottom border-secondary d-flex align-items-center justify-content-between p-2 p-md-3 gap-2 gap-md-3 sidebar-header-container"},ce={key:0,type:"button",class:"btn-close btn-close-white d-lg-none flex-shrink-0 ms-2","data-bs-dismiss":"offcanvas","aria-label":"Close"},ue={class:"flex-grow-1 overflow-auto mt-3"},fe={class:"list-unstyled mb-0"},me={class:"mb-2"},ve={class:"mb-2"},pe={class:"sidebar-footer border-top px-3 py-3"},ge={class:"d-flex align-items-center justify-content-between mb-2"},be={class:"text-white-50 small fw-medium"},he="/static/images/icon.png",we=L({__name:"SidebarNav",props:{sidebarId:{type:String,default:"sidebar"},showClose:{type:Boolean,default:!1},versionLabel:{type:String,default:""},onLogout:{type:Function,default:null},onLoadVersion:{type:Function,default:null}},setup(t){const s=t,a=N(s,"versionLabel"),r=v(typeof window<"u"?window.location.pathname:""),o=d=>r.value===d,n=()=>{o("/dashboard")&&window.location.assign("/dashboard")},m=async()=>{if(s.onLogout){await s.onLogout();return}window.location.assign("/")};return W(async()=>{r.value=window.location.pathname,s.onLoadVersion&&await s.onLoadVersion()}),(d,l)=>(x(),S("aside",{id:t.sidebarId,class:"offcanvas offcanvas-start sidebar h-100 d-flex flex-column",tabindex:"-1","aria-labelledby":"sidebarLabel"},[e("div",de,[e("div",{class:"d-flex align-items-center flex-grow-1 min-w-0 gap-2 gap-md-3 sidebar-header-content"},[e("div",{class:"d-flex align-items-center justify-content-center flex-shrink-0 logo-icon"},[e("img",{src:he,alt:"Save N Load",class:"img-fluid",width:"50",height:"50"})]),l[0]||(l[0]=e("span",{class:"text-white fw-bold text-truncate fs-5 sidebar-header-text"},"Save N Load",-1))]),t.showClose?(x(),S("button",ce)):P("",!0)]),e("nav",ue,[e("ul",fe,[e("li",me,[_(I,{to:"/dashboard","link-class":"sidebar-nav-link d-flex align-items-center text-white text-decoration-none px-3 py-2 rounded",class:M({active:o("/dashboard")}),onClick:n},{default:y(()=>[...l[1]||(l[1]=[e("i",{class:"fas fa-home me-2"},null,-1),e("span",{class:"flex-grow-1"},"Home",-1)])]),_:1},8,["class"])]),e("li",ve,[_(I,{to:"/settings","link-class":"sidebar-nav-link d-flex align-items-center text-white text-decoration-none px-3 py-2 rounded",class:M({active:o("/settings")})},{default:y(()=>[...l[2]||(l[2]=[e("i",{class:"fas fa-cog me-2"},null,-1),e("span",{class:"flex-grow-1"},"Settings",-1)])]),_:1},8,["class"])])])]),e("div",pe,[e("div",ge,[e("span",be,g(a.value),1)]),e("div",{class:"d-flex align-items-center justify-content-between"},[l[4]||(l[4]=e("div",{class:"text-white-50 small opacity-75"},"Â© 2026 SaveNLoadModern",-1)),e("button",{class:"btn p-0 text-white-50",type:"button",title:"Logout","aria-label":"Logout",onClick:m},[...l[3]||(l[3]=[e("i",{class:"fas fa-sign-out-alt fs-4"},null,-1)])])])])],8,ie))}}),B=$(we,[["__scopeId","data-v-6fc180f3"]]),A=new Map,U=t=>{const s=window?.bootstrap;return s?.Modal?s.Modal.getOrCreateInstance(t):null},_e=()=>{const t=Array.from(document.querySelectorAll(".modal.show:not(.modal-shell-root)")),s=Array.from(document.querySelectorAll(".modal-shell-root.show")),a=Array.from(document.querySelectorAll(".modal-shell-backdrop.show"));if(!t.length&&!s.length&&!a.length)return null;const r=`modal_${Math.random().toString(36).slice(2,10)}`;return A.set(r,{elements:t,shellElements:s,shellBackdrops:a}),t.forEach(o=>{U(o)?.hide()}),s.forEach(o=>o.classList.add("modal-shell-paused")),a.forEach(o=>o.classList.add("modal-shell-paused")),r},ye=t=>{if(!t)return;const s=A.get(t);s&&(A.delete(t),s.elements.forEach(a=>{U(a)?.show()}),s.shellElements.forEach(a=>a.classList.remove("modal-shell-paused")),s.shellBackdrops.forEach(a=>a.classList.remove("modal-shell-paused")))},u=j({open:!1,title:"Confirm",message:"Are you sure?",confirmText:"Confirm",cancelText:"Cancel",variant:"primary",resolve:null,pauseToken:null}),R=()=>{u.open=!1,u.resolve=null,ye(u.pauseToken),u.pauseToken=null},xe=(t={})=>(u.title=t.title||"Confirm",u.message=t.message||"Are you sure?",u.confirmText=t.confirmText||"Confirm",u.cancelText=t.cancelText||"Cancel",u.variant=t.variant||"primary",u.pauseToken=_e(),u.open=!0,new Promise(s=>{u.resolve=s})),ke=()=>{u.resolve&&u.resolve(!0),R()},Se=()=>{u.resolve&&u.resolve(!1),R()},Le=()=>({state:u,requestConfirm:xe,confirmAction:ke,cancelAction:Se}),$e={class:"modal-header modal-shell__header"},Ce={class:"modal-body modal-shell__body"},Me={class:"text-white-50 mb-0"},Ae={class:"modal-footer modal-shell__footer d-flex justify-content-end"},Te=L({__name:"ConfirmModal",setup(t){const{state:s,confirmAction:a,cancelAction:r}=Le(),o=`confirmModalTitle_${Math.random().toString(36).slice(2,8)}`,n=k(()=>s.variant==="danger"?"btn btn-danger text-white":"btn btn-light text-primary");return(m,d)=>(x(),F(O,{open:f(s).open,show:f(s).open,"labelled-by":o,"modal-class":"confirm-modal","backdrop-class":"confirm-modal-backdrop","dialog-style":"max-width: 420px;",onBackdrop:f(r)},{header:y(()=>[e("div",$e,[e("h5",{id:o,class:"modal-title text-white mb-0"},g(f(s).title),1),e("button",{class:"btn-close btn-close-white",type:"button","aria-label":"Close",onClick:d[0]||(d[0]=(...l)=>f(r)&&f(r)(...l))})])]),body:y(()=>[e("div",Ce,[e("p",Me,g(f(s).message),1)])]),footer:y(()=>[e("div",Ae,[e("button",{class:"btn btn-outline-secondary text-white",type:"button",onClick:d[1]||(d[1]=(...l)=>f(r)&&f(r)(...l))},g(f(s).cancelText),1),e("button",{class:M(n.value),type:"button",onClick:d[2]||(d[2]=(...l)=>f(a)&&f(a)(...l))},g(f(s).confirmText),3)])]),_:1},8,["open","show","onBackdrop"]))}}),Ee=$(Te,[["__scopeId","data-v-478db565"]]),Ie={class:"d-none d-lg-block"},Be={class:"main-content"},Ve={class:"d-lg-none"},We=L({__name:"AppLayout",props:{versionLabel:{type:String,default:""},onLogout:{type:Function,default:null},onLoadVersion:{type:Function,default:null}},setup(t){return(s,a)=>(x(),S("div",null,[e("div",Ie,[_(B,{"version-label":t.versionLabel,"on-logout":t.onLogout,"on-load-version":t.onLoadVersion},null,8,["version-label","on-logout","on-load-version"])]),e("div",Be,[q(s.$slots,"default",{},void 0,!0)]),e("div",Ve,[_(B,{"sidebar-id":"sidebarMobile","show-close":!0,"version-label":t.versionLabel,"on-logout":t.onLogout,"on-load-version":t.onLoadVersion},null,8,["version-label","on-logout","on-load-version"])]),_(Ee)]))}}),De=$(We,[["__scopeId","data-v-0bf19270"]]),Ue="http://localhost:8000/api",He=D("meta",()=>{const t=v("v--");let s=null;const a=n=>n?n.startsWith("v")?n:`v${n}`:"v--";return{versionLabel:t,loadVersion:async()=>{if(s)return s;s=(async()=>{try{const n=await fetch(`${Ue}/meta/version`,{credentials:"include"});if(!n.ok)return;const m=await n.json();t.value=a(m?.version||"")}catch{}})();try{await s}finally{s=null}},setVersion:n=>{t.value=a(n)}}}),Oe=t=>{const s=v(null),a=v(!1),r=v("");let o=null,n=null,m=!0;const d=async()=>t.getWsToken?t.getWsToken():J(),l=()=>{m=!1,n&&(window.clearTimeout(n),n=null),o&&(o.close(),o=null)},C=async b=>{try{const p=JSON.parse(b.data);if(p.type==="worker_status"){const i=p.payload?.connected;s.value=typeof i=="boolean"?i:null;const c=t.suppressRedirectRef?.value??!1;i===!1&&t.onWorkerUnavailable&&!c&&await t.onWorkerUnavailable()}}catch(p){console.error("Worker status WS message error:",p)}},h=async()=>{if(!window.WebSocket||!t.userRef?.value)return;const b=await d();if(!b)return;n&&(window.clearTimeout(n),n=null);const p=z("/ws/ui/worker-status/",{token:b});o=new WebSocket(p),o.addEventListener("open",()=>{a.value=!0}),o.addEventListener("message",C),o.addEventListener("close",()=>{a.value=!1,m&&(n=window.setTimeout(h,3e3))}),o.addEventListener("error",i=>{r.value="Worker status socket error",console.error("Worker status WS error:",i),o?.close()})};return W(h),V(()=>t.userRef?.value,()=>{!o&&t.userRef?.value&&h()}),H(l),{workerAvailable:s,socketOpen:a,lastError:r}};export{De as A,qe as P,He as a,Oe as b,_e as p,ye as r,Le as u};
