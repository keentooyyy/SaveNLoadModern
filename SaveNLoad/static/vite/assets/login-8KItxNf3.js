import{d as L,m as q,u as P,c as h,o as g,w as O,a as $,r as j,v as F,b as t,n as v,t as w,e as W,f as z,g as C,h as k,i as u,j as S,k as Y,l as f,p as r,q as H,s as M,x as J,y as K,z as Q}from"./islands-CvRdAtFP.js";import{u as X,_ as Z,a as ee}from"./useAuthConfig-BH77vTcF.js";import{_ as se}from"./PasswordField.vue_vue_type_script_setup_true_lang-BHxJrb8M.js";import{_ as E,a as V}from"./InputLabel.vue_vue_type_script_setup_true_lang-DOmKMaAR.js";import{_ as ae}from"./TextInput.vue_vue_type_script_setup_true_lang-CV7Ydn7d.js";import{M as te}from"./ModalShell-CppTqaMo.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BaseLink.vue_vue_type_script_setup_true_lang-Cq0V9m-h.js";import"./BaseInput.vue_vue_type_script_setup_true_lang-BPauNQUe.js";const le=["id","disabled"],ne=["for"],ie=L({__name:"BaseCheckbox",props:q({id:{type:String,default:""},label:{type:String,default:""},disabled:{type:Boolean,default:!1},switchStyle:{type:Boolean,default:!1},inputClass:{type:String,default:""},labelClass:{type:String,default:""}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const a=P(i,"modelValue");return(p,b)=>(g(),h("div",{class:v(["form-check",{"form-switch":i.switchStyle}])},[O(t("input",{"onUpdate:modelValue":b[0]||(b[0]=c=>a.value=c),class:v(["form-check-input",i.inputClass]),type:"checkbox",id:i.id,disabled:i.disabled},null,10,le),[[F,a.value]]),i.label?(g(),h("label",{key:0,class:v(["form-check-label",i.labelClass]),for:i.id},w(i.label),11,ne)):$("",!0),j(p.$slots,"default")],2))}}),re={class:"mb-3"},de={class:"mb-2"},ue={class:"d-flex justify-content-between align-items-center"},ce={key:0,href:"/forgot-password",class:"text-secondary text-decoration-none fs-6",tabindex:"-1"},me={class:"mb-3"},fe={class:"d-grid"},ge={class:"d-grid mt-2"},be={class:"modal-header modal-shell__header"},he=["id"],pe={class:"modal-body modal-shell__body"},we={class:"text-white-50 mb-3"},ve={key:0,class:"text-white-50"},_e={key:1,class:"text-white"},ye={class:"guest-credential-card"},xe={class:"guest-credential-row"},Ce={class:"guest-credential-value"},ke={class:"guest-credential-row"},Se={class:"guest-credential-value"},Me=L({__name:"LoginPage",setup(i){const a=W(),p=z(),b=C(null);let c=null;const n=k({username:"",password:"",rememberMe:!1}),A=u(()=>a.loading),_=u(()=>a.fieldErrors),G=u(()=>a.authConfigLoaded&&a.authConfig.emailEnabled&&a.authConfig.emailRegistrationRequired);X({loadAuthConfig:()=>a.loadAuthConfig()});const d=C(null),m=u(()=>A.value||d.value!==null),R=u(()=>d.value==="login"&&m.value),N=u(()=>d.value==="guest"&&m.value),s=k({open:!1,closing:!1,manualClose:!1,loading:!1,username:"",password:"",message:"Save these credentials before closing.",titleId:`guestModalTitle_${Math.random().toString(36).slice(2,8)}`}),T=u(()=>s.open||s.closing),y=o=>{if(a.fieldErrors&&a.fieldErrors[o]){const e={...a.fieldErrors};delete e[o],a.fieldErrors=Object.keys(e).length?e:null}a.error&&(a.error="")},B=()=>{a.resetStatus()};S(()=>n.username,()=>y("username")),S(()=>n.password,()=>y("password"));const I=async()=>{if(!m.value){d.value="login";try{await a.login({username:n.username,password:n.password,rememberMe:n.rememberMe}),J.flashSuccess(a.message||"Login successful.");try{await p.loadDashboard(),window.location.assign("/dashboard")}catch(o){if(o?.status===503){window.location.assign("/worker-required");return}if(o?.status===401)return;window.location.assign("/dashboard")}}catch{}finally{d.value=null}}},U=async()=>{if(!m.value){d.value="guest",a.suppressWorkerRedirect=!0,s.open=!0,s.closing=!1,s.manualClose=!1,s.loading=!0,s.username="",s.password="";try{const e=(await a.loginGuest())?.guest_credentials;s.username=e?.username||a.user?.username||"",s.password=e?.password||""}catch{s.open=!1,a.suppressWorkerRedirect=!1}finally{d.value=null,s.loading=!1}}},x=()=>{s.manualClose=!0,a.suppressWorkerRedirect=!1,D()},D=async()=>{if(!s.manualClose||s.closing)return;if(c!==null&&(window.clearTimeout(c),c=null),s.open=!1,s.closing=!0,!a.user){s.closing=!1;return}await K();const o=b.value?.modalEl||null,e=async()=>{s.closing=!1;try{await p.loadDashboard(),window.location.assign("/dashboard")}catch(l){if(l?.status===503){window.location.assign("/worker-required");return}if(l?.status===401)return;window.location.assign("/dashboard")}};if(o){const l=()=>{o.removeEventListener("transitionend",l),e()};o.addEventListener("transitionend",l),c=window.setTimeout(()=>{o.removeEventListener("transitionend",l),e()},350);return}await e()};return(o,e)=>(g(),Y(ee,{title:"Save N Load",subtitle:"Managing saves has never been easier.","on-reset":B},{default:f(()=>[t("form",{onSubmit:H(I,["prevent"])},[t("div",re,[r(E,{text:"USERNAME OR EMAIL"}),r(ae,{modelValue:n.username,"onUpdate:modelValue":e[0]||(e[0]=l=>n.username=l),placeholder:"Enter your username or email",invalid:!!_.value?.username,required:"",tabindex:"1"},null,8,["modelValue","invalid"])]),t("div",de,[t("div",ue,[r(E,{text:"PASSWORD","label-class":"mb-0"}),G.value?(g(),h("a",ce," Forgot Password? ")):$("",!0)]),r(se,{modelValue:n.password,"onUpdate:modelValue":e[1]||(e[1]=l=>n.password=l),placeholder:"Enter your password",invalid:!!_.value?.password,tabindex:"2"},null,8,["modelValue","invalid"])]),t("div",me,[r(ie,{id:"rememberMe",modelValue:n.rememberMe,"onUpdate:modelValue":e[2]||(e[2]=l=>n.rememberMe=l),label:"Remember Me","input-class":"bg-primary border-secondary","label-class":"text-white fs-6"},null,8,["modelValue"])]),t("div",fe,[r(V,{type:"submit",variant:"secondary",class:"text-white fw-bold mt-3 py-2",disabled:m.value,loading:R.value,tabindex:"3"},{default:f(()=>[...e[3]||(e[3]=[M(" LOGIN ",-1)])]),_:1},8,["disabled","loading"])]),t("div",ge,[r(V,{type:"button",variant:"outline-secondary",class:"text-white fw-bold py-2",disabled:m.value,loading:N.value,onClick:U,tabindex:"4"},{default:f(()=>[...e[4]||(e[4]=[M(" CONTINUE AS GUEST ",-1)])]),_:1},8,["disabled","loading"])]),r(Z,{prefix:"Don't have an account? ","link-text":"Create an account",to:"/register",tabindex:"-1"})],32),r(te,{ref_key:"guestModalShell",ref:b,open:T.value,show:s.open,"labelled-by":s.titleId,"modal-class":"confirm-modal","backdrop-class":"confirm-modal-backdrop","dialog-style":"max-width: 460px;"},{header:f(()=>[t("div",be,[t("h5",{id:s.titleId,class:"modal-title text-white mb-0"},"Guest Account",8,he),t("button",{class:"btn-close btn-close-white",type:"button","aria-label":"Close",onClick:x})])]),body:f(()=>[t("div",pe,[t("p",we,w(s.message),1),s.loading?(g(),h("div",ve,"Creating guest account...")):(g(),h("div",_e,[t("div",ye,[e[7]||(e[7]=t("div",{class:"guest-credential-title"},"Your Guest Credentials",-1)),t("div",xe,[e[5]||(e[5]=t("span",{class:"guest-credential-label"},"Username",-1)),t("code",Ce,w(s.username),1)]),t("div",ke,[e[6]||(e[6]=t("span",{class:"guest-credential-label"},"Password",-1)),t("code",Se,w(s.password),1)]),e[8]||(e[8]=t("div",{class:"guest-credential-hint"}," Make a note of these credentials. You will need them to upgrade later. ",-1))])]))])]),footer:f(()=>[t("div",{class:"modal-footer modal-shell__footer d-flex justify-content-end"},[t("button",{class:"btn btn-outline-secondary text-white",type:"button",onClick:x}," Close ")])]),_:1},8,["open","show","labelled-by"])]),_:1}))}}),Ee=oe(Me,[["__scopeId","data-v-9bdd8dca"]]);Q("login",Ee);
