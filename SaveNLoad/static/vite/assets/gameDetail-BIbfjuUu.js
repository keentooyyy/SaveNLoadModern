import{d as P,G as T,e as V,E as W,g as o,i as m,A as D,k as E,o as v,l as f,b as a,p as g,c as b,t as M,q as $,s as h,K as j,z as q}from"./islands-BZEcu5Tg.js";import{u as F,a as I,P as z,A as H}from"./useWorkerStatusSocket-DZgRqAL1.js";import{_ as K}from"./GameFormFields.vue_vue_type_script_setup_true_lang-B3ExrIiX.js";import{a as k}from"./InputLabel.vue_vue_type_script_setup_true_lang-zTz6K1Md.js";import{g as J}from"./wsToken-Bm8pUQB5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BaseLink.vue_vue_type_script_setup_true_lang-Dv09fmhI.js";import"./TextInput.vue_vue_type_script_setup_true_lang-Bza2zB90.js";import"./BaseInput.vue_vue_type_script_setup_true_lang-DuTyusce.js";const O={class:"container-fluid px-0"},Q={class:"container-fluid px-3 px-md-4"},X={key:0,class:"text-center py-5"},Y={key:1,class:"alert alert-danger bg-danger bg-opacity-25 border-danger text-white"},Z={key:2,class:"row g-4 justify-content-center mt-3"},ee={class:"col-12 col-lg-8"},ae={class:"card bg-primary border-secondary"},te={class:"card-body"},se={class:"d-flex gap-2 justify-content-end mt-3"},oe=P({__name:"GameDetailPage",setup(ne){const S=T(),n=V(),y=F(),x=W(n,"suppressWorkerRedirect"),i=o(null),r=o(""),d=o(""),u=o([""]),p=o(!0),l=o(!1),c=o(""),N=m(()=>n.user?.username||""),B=m(()=>(n.user?.role||"").toUpperCase()),L=m(()=>y.versionLabel),w=async()=>{p.value=!0,c.value="";try{if(!i.value){window.location.assign("/dashboard");return}const e=(await j(`/games/${i.value}/`))?.game;if(!e){window.location.assign("/dashboard");return}d.value=e.name||"",r.value=e.banner||"";const s=Array.isArray(e.save_file_locations)?e.save_file_locations:[];u.value=s.length?[...s]:[""]}catch(t){c.value=t?.message||"Failed to load game."}finally{p.value=!1}},U=async()=>{if(!(l.value||!i.value)){l.value=!0;try{await S.updateGame(i.value,{name:d.value.trim(),banner:r.value.trim(),save_file_locations:u.value.map(t=>t.trim()).filter(Boolean)}),await w()}catch{}finally{l.value=!1}}},G=()=>{window.history.back()};D(()=>{const t=window.location.pathname.split("/").filter(Boolean),e=t.length>=2?Number(t[1]):NaN;i.value=Number.isFinite(e)?e:null,n.refreshUser(),w()});const A=()=>window.location.assign("/settings"),R=()=>window.location.assign("/settings"),_=async()=>{try{await n.logout()}catch{}finally{window.location.assign("/login")}},C=async()=>{await y.loadVersion()};return I({userRef:m(()=>n.user),suppressRedirectRef:x,getWsToken:()=>J(),onWorkerUnavailable:()=>{window.location.assign("/worker-required")}}),(t,e)=>(v(),E(H,{"version-label":L.value,"on-logout":_,"on-load-version":C},{default:f(()=>[a("div",O,[g(z,{title:"Game Details","user-label":N.value,"user-role":B.value,onProfile:R,onSettings:A,onLogout:_},null,8,["user-label","user-role"]),a("div",Q,[p.value?(v(),b("div",X,[...e[3]||(e[3]=[a("div",{class:"spinner-border text-secondary",role:"status"},[a("span",{class:"visually-hidden"},"Loading...")],-1),a("p",{class:"text-white-50 mt-2 mb-0"},"Loading game data...",-1)])])):c.value?(v(),b("div",Y,M(c.value),1)):(v(),b("div",Z,[a("div",ee,[a("div",ae,[a("div",te,[e[6]||(e[6]=a("h5",{class:"text-white mb-3"},"Edit Game",-1)),a("form",{onSubmit:$(U,["prevent"])},[g(K,{prefix:"detail","banner-url":r.value,"onUpdate:bannerUrl":e[0]||(e[0]=s=>r.value=s),"game-name":d.value,"onUpdate:gameName":e[1]||(e[1]=s=>d.value=s),"save-locations":u.value,"onUpdate:saveLocations":e[2]||(e[2]=s=>u.value=s)},null,8,["banner-url","game-name","save-locations"]),a("div",se,[g(k,{type:"button",variant:"outline-secondary",class:"text-white",onClick:G},{default:f(()=>[...e[4]||(e[4]=[h(" Back ",-1)])]),_:1}),g(k,{type:"submit",variant:"secondary",class:"text-white",loading:l.value,disabled:l.value},{default:f(()=>[...e[5]||(e[5]=[h(" Save Changes ",-1)])]),_:1},8,["loading","disabled"])])],32)])])])]))])])]),_:1},8,["version-label"]))}});q("game-detail",oe);
