import{d as T,g as w,A as K,B as Ee,c as k,o as d,b as e,n as D,t as A,r as Q,m as se,u as pe,F as z,p as r,l as v,s as U,C as le,q as O,k as x,D as ie,a as M,T as Pe,h as ee,w as te,v as ae,j as ge,x as ce,E as ne,i as q,e as Ve,G as Re,z as Ie}from"./islands-CvRdAtFP.js";import{u as re,a as Me,b as Ge,P as Te,A as De}from"./useWorkerStatusSocket-BPxXwfhu.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ve}from"./GameFormFields.vue_vue_type_script_setup_true_lang-C7vjYrEU.js";import{a as R,_ as G}from"./InputLabel.vue_vue_type_script_setup_true_lang-DOmKMaAR.js";import{_ as W}from"./TextInput.vue_vue_type_script_setup_true_lang-CV7Ydn7d.js";import{_ as X,a as N}from"./EmptyState.vue_vue_type_script_setup_true_lang-D-MaYuCm.js";import{M as de}from"./ModalShell-CppTqaMo.js";import{_ as J}from"./PasswordField.vue_vue_type_script_setup_true_lang-BHxJrb8M.js";import{g as qe}from"./wsToken-mbUjdKxf.js";import"./BaseLink.vue_vue_type_script_setup_true_lang-Cq0V9m-h.js";import"./BaseInput.vue_vue_type_script_setup_true_lang-BPauNQUe.js";const Fe={class:"container-fluid px-4 pt-3"},We={class:"card shadow-lg card-primary"},Le=["data-bs-target","aria-expanded","aria-controls"],Oe={class:"d-flex align-items-center"},Ke=["id"],Ne=["id"],Be=T({__name:"CollapsibleCard",props:{title:{type:String,required:!0},icon:{type:String,required:!0},collapseId:{type:String,required:!0},headerClass:{type:String,default:""},iconClass:{type:String,default:""},titleClass:{type:String,default:""},chevronClass:{type:String,default:""},chevronId:{type:String,default:""},bodyClass:{type:String,default:""}},setup(i){const l=i,t=w(!1);let a=null;const g=()=>{t.value=!0},u=()=>{t.value=!1};return K(()=>{a=document.getElementById(l.collapseId),a&&(a.addEventListener("show.bs.collapse",g),a.addEventListener("hide.bs.collapse",u),a.classList.contains("show")&&(t.value=!0))}),Ee(()=>{a&&(a.removeEventListener("show.bs.collapse",g),a.removeEventListener("hide.bs.collapse",u))}),(m,_)=>(d(),k("div",Fe,[e("div",We,[e("button",{class:D(["card-header text-white border-0 p-3 w-100 text-start d-flex justify-content-between align-items-center",[i.headerClass,{active:t.value}]]),type:"button","data-bs-toggle":"collapse","data-bs-target":`#${i.collapseId}`,"aria-expanded":t.value,"aria-controls":i.collapseId},[e("div",Oe,[e("i",{class:D(["fas me-3 text-white",[i.iconClass,i.icon]])},null,2),e("h5",{class:D(["mb-0 text-white",i.titleClass])},A(i.title),3)]),e("i",{class:D(["fas fa-chevron-right text-white",i.chevronClass]),id:i.chevronId},null,10,Ke)],10,Le),e("div",{class:"collapse",id:i.collapseId},[e("div",{class:D(["card-body",i.bodyClass])},[Q(m.$slots,"default",{},void 0,!0)],2)],8,Ne)])]))}}),j=B(Be,[["__scopeId","data-v-ab3a6f23"]]),Z=T({__name:"FormActions",props:{alignClass:{type:String,default:""}},setup(i){return(l,t)=>(d(),k("div",{class:D(["d-flex gap-2",i.alignClass])},[Q(l.$slots,"default")],2))}}),je={class:"input-group"},fe=T({__name:"InputGroup",props:se({inputId:String,inputType:{type:String,default:"text"},placeholder:String,inputClass:{type:String,default:""},buttonFirst:{type:Boolean,default:!1},buttonLabel:{type:String,default:""},buttonIcon:{type:String,default:""},buttonVariant:{type:String,default:"secondary"},buttonSize:{type:String,default:""},buttonClass:{type:String,default:""},buttonType:{type:String,default:"button"},buttonId:{type:String,default:""}},{modelValue:{default:""},modelModifiers:{}}),emits:se(["action"],["update:modelValue"]),setup(i){const l=pe(i,"modelValue");return(t,a)=>(d(),k("div",je,[i.buttonFirst?(d(),k(z,{key:0},[Q(t.$slots,"button",{},()=>[r(R,{type:i.buttonType,variant:i.buttonVariant,size:i.buttonSize,icon:i.buttonIcon,class:D(i.buttonClass),id:i.buttonId,onClick:a[0]||(a[0]=g=>t.$emit("action"))},{default:v(()=>[U(A(i.buttonLabel),1)]),_:1},8,["type","variant","size","icon","class","id"])]),Q(t.$slots,"input",{},()=>[r(W,{modelValue:l.value,"onUpdate:modelValue":a[1]||(a[1]=g=>l.value=g),id:i.inputId,type:i.inputType,placeholder:i.placeholder,"input-class":i.inputClass,onKeydown:a[2]||(a[2]=le(O(g=>t.$emit("action"),["prevent"]),["enter"]))},null,8,["modelValue","id","type","placeholder","input-class"])])],64)):(d(),k(z,{key:1},[Q(t.$slots,"input",{},()=>[r(W,{modelValue:l.value,"onUpdate:modelValue":a[3]||(a[3]=g=>l.value=g),id:i.inputId,type:i.inputType,placeholder:i.placeholder,"input-class":i.inputClass,onKeydown:a[4]||(a[4]=le(O(g=>t.$emit("action"),["prevent"]),["enter"]))},null,8,["modelValue","id","type","placeholder","input-class"])]),Q(t.$slots,"button",{},()=>[r(R,{type:i.buttonType,variant:i.buttonVariant,size:i.buttonSize,icon:i.buttonIcon,class:D(i.buttonClass),id:i.buttonId,onClick:a[5]||(a[5]=g=>t.$emit("action"))},{default:v(()=>[U(A(i.buttonLabel),1)]),_:1},8,["type","variant","size","icon","class","id"])])],64))]))}}),He={class:"modal-header modal-shell__header"},Qe={class:"modal-body modal-shell__body overflow-auto",style:{"max-height":"500px"}},ze={key:3,class:"search-results"},Ye=["onClick","onKeydown"],Je={key:0,class:"flex-shrink-0 rounded overflow-hidden bg-dark thumb"},Xe=["src","alt"],Ze={key:1,class:"flex-shrink-0 rounded bg-dark d-flex align-items-center justify-content-center thumb"},et={class:"flex-grow-1 min-w-0"},tt={class:"fw-semibold text-truncate"},at={class:"text-white-50 small text-truncate"},st={class:"modal-footer modal-shell__footer d-flex gap-2"},lt=T({__name:"GameSearchModal",props:se({open:{type:Boolean,default:!1},results:{default:()=>[]},loading:{type:Boolean,default:!1},error:{default:""}},{query:{default:""},queryModifiers:{}}),emits:se(["search","select","close"],["update:query"]),setup(i,{emit:l}){const t=l,a=pe(i,"query"),g=`gameSearchModalLabel_${Math.random().toString(36).slice(2,8)}`,u=_=>{const n=_?.name||"Unknown",c=_?.year||"";return c?`${n} (${c})`:n},m=_=>{const n=_?.genres;return Array.isArray(n)&&n.length?n.join(", "):typeof n=="string"&&n.trim()?n:_?.company||""};return(_,n)=>(d(),x(de,{open:i.open,show:i.open,"labelled-by":g,"dialog-class":"modal-dialog-scrollable modal-lg","dialog-style":"max-width: 900px;",onBackdrop:n[4]||(n[4]=c=>t("close"))},{header:v(()=>[e("div",He,[e("h5",{class:"modal-title text-white",id:g},"Select Item"),e("button",{type:"button",class:"btn-close btn-close-white","aria-label":"Close",onClick:n[0]||(n[0]=c=>t("close"))})])]),body:v(()=>[e("div",Qe,[i.loading?(d(),x(X,{key:0,message:"Searching...","spinner-class":"text-secondary"})):i.error?(d(),x(N,{key:1,message:i.error},null,8,["message"])):i.results.length?(d(),k("div",ze,[(d(!0),k(z,null,ie(i.results,c=>(d(),k("div",{key:c.id,class:"bg-primary text-white d-flex align-items-center gap-3 result-item",role:"button",tabindex:"0",onClick:y=>t("select",c),onKeydown:le(O(y=>t("select",c),["prevent"]),["enter"])},[c.banner?(d(),k("div",Je,[e("img",{src:c.banner,alt:c.name,class:"w-100 h-100 object-fit-cover",referrerpolicy:"no-referrer"},null,8,Xe)])):(d(),k("div",Ze,[...n[5]||(n[5]=[e("i",{class:"fas fa-gamepad text-white-50 fs-4"},null,-1)])])),e("div",et,[e("div",tt,A(u(c)),1),e("div",at,A(m(c)),1)])],40,Ye))),128))])):(d(),x(N,{key:2,message:"No games found."}))])]),footer:v(()=>[e("div",st,[r(fe,{"button-first":"",modelValue:a.value,"onUpdate:modelValue":n[1]||(n[1]=c=>a.value=c),placeholder:"Type game name to search...","button-label":"Search","button-icon":"fa-search","button-class":"text-white",onAction:n[2]||(n[2]=c=>t("search")),class:"flex-fill"},null,8,["modelValue"]),r(R,{type:"button",variant:"outline-secondary",class:"text-white",onClick:n[3]||(n[3]=c=>t("close"))},{default:v(()=>[...n[6]||(n[6]=[U(" Cancel ",-1)])]),_:1})])]),_:1},8,["open","show"]))}}),nt=B(lt,[["__scopeId","data-v-d99025cd"]]),ot={class:"d-flex justify-content-end mb-3"},it={key:0,class:"mb-4"},rt={class:"mb-3"},dt={key:0,class:"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center bg-dark bg-opacity-75 search-overlay"},ut=T({__name:"AddGamePanel",props:{createGame:{type:Function}},setup(i){const l=i,t="http://localhost:8000/api",a=w(!1),g=w(""),u=w(""),m=w([]),_=w(!1),n=w(""),c=w(!1),y=w(""),p=w(""),b=w([""]),S=w(!1),L=()=>{a.value=!a.value},I=()=>{c.value=!0},F=async P=>{const h=P.trim();if(h.length<2){m.value=[],n.value="Enter at least 2 characters.",I();return}_.value=!0,n.value="";try{const V=await fetch(`${t}/settings/search?q=${encodeURIComponent(h)}`,{credentials:"include"}),Y=await V.json().catch(()=>null);V.ok?m.value=Y?.games||[]:(n.value=Y?.error||Y?.message||"",m.value=[])}catch{n.value="",m.value=[]}finally{_.value=!1,I()}},$=()=>{u.value=g.value,F(g.value)},o=()=>{F(u.value)},s=P=>{p.value=P?.name||"",y.value=P?.banner||"";const h=Array.isArray(P?.save_file_locations)?P.save_file_locations:[];b.value=h.length?[...h]:[""],c.value=!1},f=()=>{y.value="",p.value="",b.value=[""]},E=async()=>{const P=p.value.trim(),h=b.value.map(V=>V.trim()).filter(Boolean);S.value=!0;try{await l.createGame({name:P,save_file_locations:h,banner:y.value.trim()||""}),f()}finally{S.value=!1}};return(P,h)=>(d(),x(j,{title:"Add Game",icon:"fa-chart-bar","collapse-id":"addGameFormCollapse","header-class":"add-game-header","icon-class":"add-game-icon","title-class":"add-game-title","chevron-class":"add-game-chevron","chevron-id":"addGameChevron"},{default:v(()=>[e("div",ot,[r(R,{variant:"outline-secondary",size:"sm",class:"text-white",icon:"fa-search",onClick:L},{default:v(()=>[...h[6]||(h[6]=[U(" Search Game ",-1)])]),_:1})]),a.value?(d(),k("div",it,[e("div",rt,[r(G,{text:"SEARCH BY GAME NAME"}),r(fe,{modelValue:g.value,"onUpdate:modelValue":h[0]||(h[0]=V=>g.value=V),placeholder:"Type game name to search...","button-label":"Search","button-icon":"fa-search","button-class":"text-white",onAction:$},null,8,["modelValue"])]),h[7]||(h[7]=e("hr",{class:"border-secondary"},null,-1))])):M("",!0),e("form",{id:"addGameForm",onSubmit:O(E,["prevent"]),onReset:O(f,["prevent"])},[r(ve,{prefix:"add","banner-url":y.value,"onUpdate:bannerUrl":h[1]||(h[1]=V=>y.value=V),"game-name":p.value,"onUpdate:gameName":h[2]||(h[2]=V=>p.value=V),"save-locations":b.value,"onUpdate:saveLocations":h[3]||(h[3]=V=>b.value=V)},null,8,["banner-url","game-name","save-locations"]),r(Z,null,{default:v(()=>[r(R,{type:"submit",variant:"secondary",class:"text-white fw-bold",icon:"fa-save",disabled:S.value},{default:v(()=>[...h[8]||(h[8]=[U(" Save Game ",-1)])]),_:1},8,["disabled"]),r(R,{type:"reset",variant:"outline-secondary",class:"text-white",disabled:S.value},{default:v(()=>[...h[9]||(h[9]=[U("Clear",-1)])]),_:1},8,["disabled"])]),_:1})],32),r(nt,{query:u.value,"onUpdate:query":h[4]||(h[4]=V=>u.value=V),open:c.value,results:m.value,loading:_.value,error:n.value,onSearch:o,onSelect:s,onClose:h[5]||(h[5]=V=>c.value=!1)},null,8,["query","open","results","loading","error"]),(d(),x(Pe,{to:"body"},[_.value?(d(),k("div",dt,[...h[10]||(h[10]=[e("div",{class:"text-center text-white"},[e("div",{class:"spinner-border",role:"status","aria-live":"polite"},[e("span",{class:"visually-hidden"},"Loading...")]),e("p",{class:"mt-3 mb-0"},"Searching for games...")],-1)])])):M("",!0)]))]),_:1}))}}),ct=B(ut,[["__scopeId","data-v-e03edc98"]]),mt={class:"mb-3"},pt={class:"form-check form-switch"},gt={key:0,class:"mb-3"},vt={class:"position-relative"},ft={class:"mb-3"},bt={class:"form-check form-switch"},yt={key:1,class:"mb-3"},wt={class:"form-check form-switch"},ht={key:2,class:"row g-3"},_t={class:"col-12 col-md-6"},kt={class:"col-12 col-md-6"},xt={class:"position-relative"},St={class:"mt-4 mb-3"},$t={class:"form-check form-switch"},Ct={key:3,class:"mb-3"},At={class:"mb-3"},Ut={class:"position-relative"},Et={class:"modal-header modal-shell__header"},Pt=["id"],Vt={class:"modal-body modal-shell__body"},Rt={class:"modal-footer modal-shell__footer d-flex justify-content-end"},It=["disabled"],Mt=T({__name:"AdminSettingsPanel",props:{loadSettings:{type:Function},updateSettings:{type:Function},checkHealth:{type:Function},revealSettings:{type:Function}},setup(i){const l=i,t=ee({rawgEnabled:!1,rawgApiKey:"",emailEnabled:!1,emailRegistrationRequired:!0,gmailUser:"",gmailAppPassword:"",guestEnabled:!1,guestTtlDays:"14",resetDefaultPassword:""}),a=w(!1),g=w(!1),u=w(!1),m=ee({rawgApiKey:!1,gmailAppPassword:!1,resetDefaultPassword:!1}),_=ee({rawgApiKey:!1,gmailAppPassword:!1,resetDefaultPassword:!1}),n=ee({open:!1,keys:[],label:"",password:"",titleId:`revealModalTitle_${Math.random().toString(36).slice(2,8)}`}),c=o=>{t.rawgEnabled=!!o["feature.rawg.enabled"],t.rawgApiKey=o["rawg.api_key"]||"",t.emailEnabled=!!o["feature.email.enabled"],t.emailRegistrationRequired=o["feature.email.registration_required"]!==!1,t.gmailUser=o["email.gmail_user"]||"",t.gmailAppPassword=o["email.gmail_app_password"]||"",t.guestEnabled=!!o["feature.guest.enabled"],t.guestTtlDays=String(o["feature.guest.ttl_days"]??"14"),t.resetDefaultPassword=o["reset.default_password"]||""},y=async()=>{a.value=!0;try{const o=await l.loadSettings();c(o||{})}finally{a.value=!1}},p=async()=>{if(!a.value){a.value=!0;try{await l.updateSettings({"feature.rawg.enabled":t.rawgEnabled,"rawg.api_key":t.rawgApiKey.trim(),"feature.email.enabled":t.emailEnabled,"feature.email.registration_required":t.emailRegistrationRequired,"email.gmail_user":t.gmailUser.trim(),"email.gmail_app_password":t.gmailAppPassword.trim(),"feature.guest.enabled":t.guestEnabled,"feature.guest.ttl_days":Number(t.guestTtlDays),"reset.default_password":t.resetDefaultPassword});const o=window.toastr;o?.success&&o.success("Admin settings saved.")}catch{const o=window.toastr;o?.error&&o.error("Failed to save admin settings.")}finally{a.value=!1}}},b=async()=>{if(g.value)return;g.value=!0;const o=await l.checkHealth();if(g.value=!1,!o)return;const s=window.toastr;if(!s)return;const f=$(o.rawg),E=$(o.email),P=`RAWG: ${f}
Email: ${E}`;o.rawg?.healthy&&o.email?.healthy&&s.success?s.success(P,"Health Check"):s.warning?s.warning(P,"Health Check"):s.info&&s.info(P,"Health Check")},S=(o,s)=>{n.open=!0,n.keys=o,n.label=s,n.password=""},L=(o,s,f)=>{if(m[o]){m[o]=!1;return}if(_[o]){m[o]=!0;return}S(s,f)},I=()=>{n.open=!1,n.keys=[],n.label="",n.password=""},F=async()=>{if(n.password&&!u.value){u.value=!0;try{const o=await l.revealSettings(n.keys,n.password);o["rawg.api_key"]!==void 0&&(t.rawgApiKey=o["rawg.api_key"]||"",m.rawgApiKey=!0,_.rawgApiKey=!0),o["email.gmail_app_password"]!==void 0&&(t.gmailAppPassword=o["email.gmail_app_password"]||"",m.gmailAppPassword=!0,_.gmailAppPassword=!0),o["reset.default_password"]!==void 0&&(t.resetDefaultPassword=o["reset.default_password"]||"",m.resetDefaultPassword=!0,_.resetDefaultPassword=!0),I()}catch{}finally{u.value=!1}}},$=o=>{if(!o)return"No data";const s=o.enabled?o.healthy?"Healthy":"Unhealthy":"Disabled",f=o.message?` - ${o.message}`:"";return`${s}${f}`};return K(()=>{y()}),(o,s)=>(d(),k(z,null,[r(j,{title:"Admin Settings",icon:"fa-sliders-h","collapse-id":"adminSettingsCollapse","header-class":"admin-settings-header","icon-class":"admin-settings-icon","title-class":"admin-settings-title","chevron-class":"admin-settings-chevron","chevron-id":"adminSettingsChevron"},{default:v(()=>[e("form",{onSubmit:O(p,["prevent"])},[s[19]||(s[19]=e("p",{class:"text-white-50 small mb-3"}," Features default to OFF until explicitly enabled and configured. ",-1)),e("div",mt,[e("div",pt,[te(e("input",{id:"rawgEnabled",class:"form-check-input bg-primary border-secondary",type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=f=>t.rawgEnabled=f)},null,512),[[ae,t.rawgEnabled]]),s[13]||(s[13]=e("label",{class:"form-check-label text-white",for:"rawgEnabled"},"Enable RAWG",-1))])]),t.rawgEnabled?(d(),k("div",gt,[r(G,{"for-id":"rawgApiKey",text:"RAWG API KEY"}),e("div",vt,[r(W,{id:"rawgApiKey",modelValue:t.rawgApiKey,"onUpdate:modelValue":s[1]||(s[1]=f=>t.rawgApiKey=f),type:m.rawgApiKey?"text":"password",placeholder:"Enter RAWG API key","input-class":"pe-5"},null,8,["modelValue","type"]),e("i",{class:D(["position-absolute top-50 end-0 translate-middle-y me-3 text-white-50 fw-light",m.rawgApiKey?"fas fa-eye-slash":"fas fa-eye"]),role:"button",tabindex:"-1",onClick:s[2]||(s[2]=f=>L("rawgApiKey",["rawg.api_key"],"RAWG API Key"))},null,2)])])):M("",!0),e("div",ft,[e("div",bt,[te(e("input",{id:"emailEnabled",class:"form-check-input bg-primary border-secondary",type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=f=>t.emailEnabled=f)},null,512),[[ae,t.emailEnabled]]),s[14]||(s[14]=e("label",{class:"form-check-label text-white",for:"emailEnabled"},"Enable Email",-1))])]),t.emailEnabled?(d(),k("div",yt,[e("div",wt,[te(e("input",{id:"emailRegistrationRequired",class:"form-check-input bg-primary border-secondary",type:"checkbox","onUpdate:modelValue":s[4]||(s[4]=f=>t.emailRegistrationRequired=f)},null,512),[[ae,t.emailRegistrationRequired]]),s[15]||(s[15]=e("label",{class:"form-check-label text-white",for:"emailRegistrationRequired"}," Require Email on Registration ",-1))])])):M("",!0),t.emailEnabled?(d(),k("div",ht,[e("div",_t,[r(G,{"for-id":"gmailUser",text:"GMAIL USER"}),r(W,{id:"gmailUser",modelValue:t.gmailUser,"onUpdate:modelValue":s[5]||(s[5]=f=>t.gmailUser=f),placeholder:"you@gmail.com"},null,8,["modelValue"])]),e("div",kt,[r(G,{"for-id":"gmailAppPassword",text:"GMAIL APP PASSWORD"}),e("div",xt,[r(W,{id:"gmailAppPassword",modelValue:t.gmailAppPassword,"onUpdate:modelValue":s[6]||(s[6]=f=>t.gmailAppPassword=f),type:m.gmailAppPassword?"text":"password",placeholder:"App password","input-class":"pe-5"},null,8,["modelValue","type"]),e("i",{class:D(["position-absolute top-50 end-0 translate-middle-y me-3 text-white-50 fw-light",m.gmailAppPassword?"fas fa-eye-slash":"fas fa-eye"]),role:"button",tabindex:"-1",onClick:s[7]||(s[7]=f=>L("gmailAppPassword",["email.gmail_app_password"],"Gmail App Password"))},null,2)])])])):M("",!0),e("div",St,[e("div",$t,[te(e("input",{id:"guestEnabled",class:"form-check-input bg-primary border-secondary",type:"checkbox","onUpdate:modelValue":s[8]||(s[8]=f=>t.guestEnabled=f)},null,512),[[ae,t.guestEnabled]]),s[16]||(s[16]=e("label",{class:"form-check-label text-white",for:"guestEnabled"},"Enable Guest Accounts",-1))])]),t.guestEnabled?(d(),k("div",Ct,[r(G,{"for-id":"guestTtl",text:"GUEST ACCOUNT EXPIRY (DAYS)"}),r(W,{id:"guestTtl",modelValue:t.guestTtlDays,"onUpdate:modelValue":s[9]||(s[9]=f=>t.guestTtlDays=f),placeholder:"14"},null,8,["modelValue"])])):M("",!0),e("div",At,[r(G,{"for-id":"defaultPassword",text:"RESET DEFAULT PASSWORD"}),e("div",Ut,[r(W,{id:"defaultPassword",modelValue:t.resetDefaultPassword,"onUpdate:modelValue":s[10]||(s[10]=f=>t.resetDefaultPassword=f),type:m.resetDefaultPassword?"text":"password",placeholder:"Enter default reset password","input-class":"pe-5"},null,8,["modelValue","type"]),e("i",{class:D(["position-absolute top-50 end-0 translate-middle-y me-3 text-white-50 fw-light",m.resetDefaultPassword?"fas fa-eye-slash":"fas fa-eye"]),role:"button",tabindex:"-1",onClick:s[11]||(s[11]=f=>L("resetDefaultPassword",["reset.default_password"],"Reset Default Password"))},null,2)])]),r(Z,null,{default:v(()=>[r(R,{type:"submit",variant:"secondary",class:"text-white fw-bold",icon:"fa-save",disabled:a.value,loading:a.value},{default:v(()=>[...s[17]||(s[17]=[U(" Save Settings ",-1)])]),_:1},8,["disabled","loading"]),r(R,{type:"button",variant:"outline-secondary",class:"text-white",icon:"fa-heart-pulse",disabled:a.value||g.value,loading:g.value,onClick:b},{default:v(()=>[...s[18]||(s[18]=[U(" Run Health Check ",-1)])]),_:1},8,["disabled","loading"])]),_:1})],32)]),_:1}),r(de,{open:n.open,show:n.open,"labelled-by":n.titleId,"modal-class":"confirm-modal","backdrop-class":"confirm-modal-backdrop","dialog-style":"max-width: 420px;",onBackdrop:I},{header:v(()=>[e("div",Et,[e("h5",{id:n.titleId,class:"modal-title text-white mb-0"}," Reveal "+A(n.label),9,Pt),e("button",{class:"btn-close btn-close-white",type:"button","aria-label":"Close",onClick:I})])]),body:v(()=>[e("div",Vt,[s[20]||(s[20]=e("p",{class:"text-white-50 mb-3"},"Confirm your admin password to reveal this value.",-1)),r(J,{modelValue:n.password,"onUpdate:modelValue":s[12]||(s[12]=f=>n.password=f),placeholder:"Admin password"},null,8,["modelValue"])])]),footer:v(()=>[e("div",Rt,[e("button",{class:"btn btn-outline-secondary text-white",type:"button",onClick:I}," Cancel "),e("button",{class:"btn btn-light text-primary",type:"button",onClick:F,disabled:u.value}," Reveal ",8,It)])]),_:1},8,["open","show","labelled-by"])],64))}}),Gt=B(Mt,[["__scopeId","data-v-7756b71a"]]),oe=T({__name:"SectionTitle",props:{text:{type:String,required:!0},titleClass:{type:String,default:""}},setup(i){return(l,t)=>(d(),k("h6",{class:D(["text-white mb-3 fw-bold",i.titleClass])},A(i.text),3))}}),Tt={class:"mb-4"},Dt={class:"mb-3"},qt={class:"text-white"},Ft={key:3,class:"table-responsive"},Wt={class:"table table-dark table-hover align-middle mb-0 manage-users-table"},Lt={class:"fw-semibold text-white"},Ot={class:"text-white-50"},Kt={class:"text-end"},Nt={class:"d-inline-flex gap-2"},Bt=["onClick"],jt=["onClick"],Ht={key:4,class:"d-flex justify-content-between align-items-center mt-3"},Qt=["disabled"],zt={class:"text-white-50 small"},Yt=["disabled"],Jt=T({__name:"ManageAccountsPanel",props:{listUsers:{type:Function},resetUserPassword:{type:Function},deleteUser:{type:Function},checkOperationStatus:{type:Function}},setup(i){const l=i,{requestConfirm:t}=re(),a=w(""),g=w([]),u=w(!1),m=w(""),_=w(!1),n=w({page:1,total_pages:1,has_next:!1,has_previous:!1}),c=async($=1)=>{u.value=!0,m.value="";try{const o=await l.listUsers(a.value.trim(),$);g.value=o?.users||[],n.value=o?.pagination||{page:$,total_pages:1,has_next:!1,has_previous:!1}}catch(o){m.value=o?.message||""}finally{u.value=!1}},y=$=>{c($)},p=async $=>{await t({title:"Reset Password",message:`Reset password for ${$.username}?`,confirmText:"Reset",variant:"danger"})&&await l.resetUserPassword($.id)},b=async $=>{for(let f=0;f<20;f+=1){try{const E=await l.checkOperationStatus($);if(E?.completed||E?.status==="completed")return{status:"completed",message:E?.message||""};if(E?.failed||E?.status==="failed")return{status:"failed",message:E?.message||E?.error||""}}catch{return{status:"failed",message:""}}await new Promise(E=>setTimeout(E,2e3))}return{status:"failed",message:""}},S=()=>{const $=document.getElementById("manageAccountsCollapse"),o=window?.bootstrap;if(!$||!o?.Collapse)return;o.Collapse.getOrCreateInstance($,{toggle:!1}).show()},L=($=0)=>{_.value=!0;try{window.sessionStorage.setItem("savenload_open_manage_accounts","1")}catch{}window.setTimeout(()=>{window.location.reload()},Math.max(0,$))},I=async $=>{if(await t({title:"Delete User",message:`Delete user ${$.username}? This cannot be undone.`,confirmText:"Delete",variant:"danger"})){u.value=!0,m.value="";try{const s=await l.deleteUser($.id),f=s?.operation_id;let E=s?.message||"";if(f){const P=await b(f);if(P.status!=="completed")throw new Error(P.message);E=P.message}E&&ce.flashSuccess(E),L(0)}catch(s){m.value=s?.message||"",m.value&&ce.error(m.value)}finally{_.value||(u.value=!1)}}};let F=null;return ge(a,()=>{F&&window.clearTimeout(F),F=window.setTimeout(()=>{c(1)},300)}),K(async()=>{await c(1);try{window.sessionStorage.getItem("savenload_open_manage_accounts")==="1"&&(window.sessionStorage.removeItem("savenload_open_manage_accounts"),S())}catch{}}),($,o)=>(d(),x(j,{title:"Manage Accounts",icon:"fa-users","collapse-id":"manageAccountsCollapse","header-class":"manage-accounts-header","icon-class":"manage-accounts-icon","title-class":"manage-accounts-title","chevron-class":"manage-accounts-chevron","chevron-id":"manageAccountsChevron"},{default:v(()=>[e("div",Tt,[r(G,{text:"SEARCH BY USERNAME OR EMAIL","label-class":"mb-2"}),r(W,{modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=s=>a.value=s),placeholder:"Type username or email to search...",disabled:_.value},null,8,["modelValue","disabled"])]),o[4]||(o[4]=e("hr",{class:"border-secondary mb-4"},null,-1)),e("div",Dt,[r(oe,{text:"All Users"}),e("div",qt,[u.value?(d(),x(X,{key:0})):m.value?(d(),x(N,{key:1,message:m.value},null,8,["message"])):g.value.length?(d(),k("div",Ft,[e("table",Wt,[o[3]||(o[3]=e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"text-white-50"},"Username"),e("th",{scope:"col",class:"text-white-50"},"Email"),e("th",{scope:"col",class:"text-white-50 text-end"},"Actions")])],-1)),e("tbody",null,[(d(!0),k(z,null,ie(g.value,s=>(d(),k("tr",{key:s.id},[e("td",Lt,A(s.username),1),e("td",Ot,A(s.email),1),e("td",Kt,[e("div",Nt,[e("button",{class:"btn btn-sm btn-outline-secondary text-white",type:"button",onClick:f=>p(s)}," Reset Password ",8,Bt),e("button",{class:"btn btn-sm btn-outline-danger text-white",type:"button",onClick:f=>I(s)}," Delete ",8,jt)])])]))),128))])])])):(d(),x(N,{key:2,message:"No users found."})),n.value.total_pages>1?(d(),k("div",Ht,[e("button",{class:"btn btn-sm btn-outline-light",type:"button",disabled:!n.value.has_previous,onClick:o[1]||(o[1]=s=>y(n.value.page-1))}," Prev ",8,Qt),e("span",zt,"Page "+A(n.value.page)+" of "+A(n.value.total_pages),1),e("button",{class:"btn btn-sm btn-outline-light",type:"button",disabled:!n.value.has_next,onClick:o[2]||(o[2]=s=>y(n.value.page+1))}," Next ",8,Yt)])):M("",!0)])])]),_:1}))}}),Xt=B(Jt,[["__scopeId","data-v-ed3bf665"]]),Zt={class:"mb-4"},ea={class:"text-white"},ta={key:2,class:"d-flex flex-column gap-2"},aa={class:"d-flex justify-content-between"},sa={class:"fw-semibold"},la={class:"d-flex justify-content-between"},na={class:"d-flex justify-content-between"},oa={class:"d-flex justify-content-between"},ia={class:"d-flex justify-content-between"},ra=T({__name:"OperationQueuePanel",props:{loadQueueStats:{type:Function},clearQueue:{type:Function}},setup(i){const l=i,t=w(!1),a=w(""),{requestConfirm:g}=re(),u=w({total:0,by_status:{pending:0,in_progress:0,completed:0,failed:0}}),m=async()=>{t.value=!0,a.value="";try{const n=await l.loadQueueStats();u.value=n?.data||n||u.value}catch(n){a.value=n?.message||""}finally{t.value=!1}},_=async()=>{await g({title:"Clear Operations",message:"Clear all operations?",confirmText:"Clear",variant:"danger"})&&(await l.clearQueue(),m())};return K(()=>{m()}),(n,c)=>(d(),x(j,{title:"Operation Queue Management",icon:"fa-tasks","collapse-id":"operationQueueCollapse","header-class":"operation-queue-header","icon-class":"operation-queue-icon","title-class":"operation-queue-title","chevron-class":"operation-queue-chevron","chevron-id":"operationQueueChevron"},{default:v(()=>[e("div",Zt,[r(oe,{text:"Queue Statistics"}),e("div",ea,[t.value?(d(),x(X,{key:0})):a.value?(d(),x(N,{key:1,message:a.value},null,8,["message"])):(d(),k("div",ta,[e("div",aa,[c[0]||(c[0]=e("span",null,"Total",-1)),e("span",sa,A(u.value.total),1)]),e("div",la,[c[1]||(c[1]=e("span",null,"Pending",-1)),e("span",null,A(u.value.by_status.pending),1)]),e("div",na,[c[2]||(c[2]=e("span",null,"In Progress",-1)),e("span",null,A(u.value.by_status.in_progress),1)]),e("div",oa,[c[3]||(c[3]=e("span",null,"Completed",-1)),e("span",null,A(u.value.by_status.completed),1)]),e("div",ia,[c[4]||(c[4]=e("span",null,"Failed",-1)),e("span",null,A(u.value.by_status.failed),1)])]))])]),c[6]||(c[6]=e("hr",{class:"border-secondary my-4"},null,-1)),e("div",null,[r(oe,{text:"Clear Operations"}),r(R,{type:"button",variant:"secondary",class:"text-white fw-bold",icon:"fa-trash",disabled:t.value,onClick:_},{default:v(()=>[...c[5]||(c[5]=[U(" Clear All Operations ",-1)])]),_:1},8,["disabled"])])]),_:1}))}}),da={class:"mb-3"},ua={class:"mb-3"},ca={class:"mb-3"},ma={class:"mb-3"},pa=T({__name:"AccountSettingsPanel",props:{email:{},onSave:{type:Function}},setup(i){const l=i,t=w(""),a=w(""),g=w(""),u=w(""),m=w(!1),_=()=>{t.value=l.email||""},n=()=>{a.value="",g.value="",u.value=""},c=async()=>{m.value=!0;try{await l.onSave({email:t.value.trim(),current_password:a.value,new_password:g.value,confirm_password:u.value}),n()}catch(y){const p=window.toastr;p?.error&&y?.message&&p.error(y.message)}finally{m.value=!1}};return ge(()=>l.email,_),K(_),(y,p)=>(d(),x(j,{title:"Account Settings",icon:"fa-user-cog","collapse-id":"accountSettingsCollapse","header-class":"account-settings-header","icon-class":"account-settings-icon","title-class":"account-settings-title","chevron-class":"account-settings-chevron","chevron-id":"accountSettingsChevron"},{default:v(()=>[e("form",{id:"accountSettingsForm",onSubmit:O(c,["prevent"]),onReset:O(n,["prevent"])},[e("div",da,[r(G,{"for-id":"accountEmail",text:"EMAIL"}),r(W,{id:"accountEmail",modelValue:t.value,"onUpdate:modelValue":p[0]||(p[0]=b=>t.value=b),type:"email",placeholder:"Enter your email"},null,8,["modelValue"])]),e("div",ua,[r(G,{"label-class":"mb-0"},{default:v(()=>[...p[4]||(p[4]=[U(" CURRENT PASSWORD ",-1),e("span",{class:"text-white-50"},"(optional)",-1)])]),_:1}),r(J,{modelValue:a.value,"onUpdate:modelValue":p[1]||(p[1]=b=>a.value=b),placeholder:"Enter current password"},null,8,["modelValue"])]),e("div",ca,[r(G,{"label-class":"mb-0"},{default:v(()=>[...p[5]||(p[5]=[U(" NEW PASSWORD ",-1),e("span",{class:"text-white-50"},"(optional)",-1)])]),_:1}),r(J,{modelValue:g.value,"onUpdate:modelValue":p[2]||(p[2]=b=>g.value=b),placeholder:"Enter new password"},null,8,["modelValue"])]),e("div",ma,[r(G,{"label-class":"mb-0"},{default:v(()=>[...p[6]||(p[6]=[U(" CONFIRM NEW PASSWORD ",-1),e("span",{class:"text-white-50"},"(optional)",-1)])]),_:1}),r(J,{modelValue:u.value,"onUpdate:modelValue":p[3]||(p[3]=b=>u.value=b),placeholder:"Confirm new password"},null,8,["modelValue"])]),r(Z,null,{default:v(()=>[r(R,{type:"submit",variant:"secondary",class:"text-white fw-bold",icon:"fa-save",disabled:m.value},{default:v(()=>[...p[7]||(p[7]=[U(" Save Changes ",-1)])]),_:1},8,["disabled"]),r(R,{type:"reset",variant:"outline-secondary",class:"text-white",disabled:m.value},{default:v(()=>[...p[8]||(p[8]=[U("Clear",-1)])]),_:1},8,["disabled"])]),_:1})],32)]),_:1}))}}),ga={class:"modal-body modal-shell__body",style:{"max-height":"70vh","overflow-y":"auto"}},va={class:"tab-content"},fa={class:"tab-pane fade show active",id:"edit-pane",role:"tabpanel"},ba={id:"gameManageForm"},ya={class:"tab-pane fade",id:"saves-pane",role:"tabpanel"},wa={id:"savesListContainer"},ha={class:"modal-footer modal-shell__footer d-flex justify-content-end"},_a=T({__name:"ManageGameModal",props:{open:{type:Boolean,default:!1}},emits:["close"],setup(i,{emit:l}){const t=l,a=`gameManageModalLabel_${Math.random().toString(36).slice(2,8)}`;return(g,u)=>(d(),x(de,{open:i.open,show:i.open,"labelled-by":a,"dialog-class":"modal-lg"},{header:v(()=>[...u[1]||(u[1]=[e("div",{class:"modal-header modal-shell__header d-flex align-items-center"},[e("ul",{class:"nav nav-tabs border-0 mb-0",role:"tablist"},[e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link active text-white d-flex align-items-center",id:"edit-tab","data-bs-toggle":"tab","data-bs-target":"#edit-pane",type:"button",role:"tab"},[e("i",{class:"fas fa-edit me-2"}),e("span",null,"Edit")])]),e("li",{class:"nav-item",role:"presentation",id:"saves-tab-container"},[e("button",{class:"nav-link text-white-50 d-flex align-items-center",id:"saves-tab","data-bs-toggle":"tab","data-bs-target":"#saves-pane",type:"button",role:"tab"},[e("i",{class:"fas fa-folder me-2"}),e("span",null,"Available Saves")])])])],-1)])]),body:v(()=>[e("div",ga,[e("div",va,[e("div",fa,[e("form",ba,[u[2]||(u[2]=e("input",{type:"hidden",id:"manage_game_id",name:"game_id"},null,-1)),r(ve,{prefix:"manage"})])]),e("div",ya,[e("div",wa,[r(X,{message:"Loading saves...","spinner-class":"text-secondary"})])])])])]),footer:v(()=>[e("div",ha,[r(Z,{"align-class":"me-auto",id:"edit-tab-buttons"},{default:v(()=>[r(R,{type:"button",variant:"outline-danger",class:"text-white",icon:"fa-trash-alt",id:"deleteGameBtn"},{default:v(()=>[...u[3]||(u[3]=[U(" Delete ",-1)])]),_:1}),r(R,{type:"button",variant:"secondary",class:"text-white",id:"saveGameBtn"},{default:v(()=>[...u[4]||(u[4]=[U(" Save changes ",-1)])]),_:1})]),_:1}),r(R,{type:"button",variant:"outline-secondary",class:"text-white",onClick:u[0]||(u[0]=m=>t("close"))},{default:v(()=>[...u[5]||(u[5]=[U(" Close ",-1)])]),_:1})])]),_:1},8,["open","show"]))}}),ka=B(_a,[["__scopeId","data-v-3457f981"]]),xa={key:0,class:"alert alert-info mb-3"},Sa={key:1,class:"alert alert-warning mb-3"},$a={class:"mb-3"},Ca={class:"mb-3"},Aa={class:"mb-3"},me="savenload_guest_credentials",Ua=T({__name:"GuestUpgradePanel",props:{migrationStatus:{},isSubmitting:{type:Boolean},guestCredentials:{},currentUsername:{},upgradeGuest:{type:Function},refreshUser:{type:Function},checkOperationStatus:{type:Function},clearGuestCredentials:{type:Function},getIsGuest:{type:Function}},setup(i){const l=i,t=w(""),a=w(""),g=w(""),u=ne(l,"migrationStatus"),m=ne(l,"isSubmitting"),_=async()=>{if(l.isSubmitting||l.migrationStatus==="migrating")return;const c=t.value.trim();if(c.toLowerCase().includes("guest")){const y=window.toastr;y?.error&&y.error('Username cannot contain "guest".');return}try{const p=(await l.upgradeGuest({username:c,email:a.value.trim(),password:g.value}))?.operation_id;p?await n(p):(await l.refreshUser(),l.getIsGuest()||l.clearGuestCredentials())}catch{}},n=async c=>{for(let b=0;b<30;b+=1){try{const S=await l.checkOperationStatus(c);if(S?.completed||S?.failed){await l.refreshUser(),S?.completed&&!l.getIsGuest()&&l.clearGuestCredentials();return}}catch{}await new Promise(S=>setTimeout(S,2e3))}await l.refreshUser(),l.getIsGuest()||l.clearGuestCredentials()};return K(()=>{if(l.guestCredentials?.username&&(t.value=l.guestCredentials.username),l.guestCredentials?.password&&(g.value=l.guestCredentials.password),!t.value&&l.currentUsername&&(t.value=l.currentUsername),!g.value)try{const c=window.sessionStorage.getItem(me)||window.localStorage.getItem(me);if(c){const y=JSON.parse(c);!t.value&&y?.username&&(t.value=y.username),!g.value&&y?.password&&(g.value=y.password)}}catch{}}),(c,y)=>(d(),x(j,{title:"Upgrade Guest Account",icon:"fa-user-plus","collapse-id":"guestUpgradeCollapse","header-class":"guest-upgrade-header","icon-class":"guest-upgrade-icon","title-class":"guest-upgrade-title","chevron-class":"guest-upgrade-chevron","chevron-id":"guestUpgradeChevron"},{default:v(()=>[u.value==="migrating"?(d(),k("div",xa," Migration in progress. Save/load is temporarily disabled. ")):u.value==="failed"?(d(),k("div",Sa," Migration failed. Please try again. ")):M("",!0),e("form",{onSubmit:O(_,["prevent"])},[e("div",$a,[r(G,{"for-id":"guestUpgradeUsername",text:"NEW USERNAME"}),r(W,{id:"guestUpgradeUsername",modelValue:t.value,"onUpdate:modelValue":y[0]||(y[0]=p=>t.value=p),placeholder:"Choose a username",disabled:m.value,required:""},null,8,["modelValue","disabled"])]),e("div",Ca,[r(G,{"for-id":"guestUpgradeEmail",text:"EMAIL"}),r(W,{id:"guestUpgradeEmail",modelValue:a.value,"onUpdate:modelValue":y[1]||(y[1]=p=>a.value=p),type:"email",placeholder:"Enter your email",disabled:m.value,required:""},null,8,["modelValue","disabled"])]),e("div",Aa,[r(G,{"for-id":"guestUpgradePassword",text:"PASSWORD"}),r(J,{id:"guestUpgradePassword",modelValue:g.value,"onUpdate:modelValue":y[2]||(y[2]=p=>g.value=p),placeholder:"Create a password",disabled:m.value,required:""},null,8,["modelValue","disabled"])]),r(Z,null,{default:v(()=>[r(R,{type:"submit",variant:"secondary",class:"text-white fw-bold",icon:"fa-user-check",disabled:m.value||u.value==="migrating",loading:m.value},{default:v(()=>[...y[3]||(y[3]=[U(" Upgrade Account ",-1)])]),_:1},8,["disabled","loading"])]),_:1})],32)]),_:1}))}}),Ea={class:"d-flex flex-column flex-md-row justify-content-between gap-2 mb-3"},Pa={class:"d-flex gap-2"},Va={key:3,class:"table-responsive"},Ra={class:"table table-dark table-hover align-middle mb-0 worker-table"},Ia={class:"fw-semibold text-white"},Ma={key:0,class:"badge bg-warning text-dark ms-2"},Ga={key:1,class:"badge bg-dark ms-2"},Ta={class:"text-white-50"},Da={class:"text-white-50"},qa=T({__name:"WorkerManagementPanel",props:{listWorkers:{type:Function},unclaimAllWorkers:{type:Function}},setup(i){const l=i,{requestConfirm:t}=re(),a=w(!1),g=w(!1),u=w(""),m=w([]),_=q(()=>m.value.some(p=>p.claimed)),n=p=>{if(!p)return"—";const b=new Date(p);return Number.isNaN(b.getTime())?p:b.toLocaleString()},c=async()=>{a.value=!0,u.value="";try{const b=(await l.listWorkers())?.workers;b&&(m.value=b)}catch(p){u.value=p?.message||""}finally{a.value=!1}},y=async()=>{if(!(g.value||!await t({title:"Unpair All Workers",message:"This will unpair every worker except your current admin claim. Continue?",confirmText:"Unpair All",variant:"danger"}))){g.value=!0;try{const S=(await l.unclaimAllWorkers())?.workers;S&&(m.value=S)}catch(b){u.value=b?.message||""}finally{g.value=!1}}};return K(()=>{c()}),(p,b)=>(d(),x(j,{title:"Worker Management",icon:"fa-network-wired","collapse-id":"workerManagementCollapse","header-class":"worker-management-header","icon-class":"worker-management-icon","title-class":"worker-management-title","chevron-class":"worker-management-chevron","chevron-id":"workerManagementChevron"},{default:v(()=>[e("div",Ea,[b[2]||(b[2]=e("div",{class:"text-white-50 small"}," All workers are listed here. Use the kill switch to unpair everyone except your admin claim. ",-1)),e("div",Pa,[r(R,{type:"button",variant:"outline-secondary",class:"text-white",icon:"fa-sync",disabled:a.value,onClick:c},{default:v(()=>[...b[0]||(b[0]=[U(" Refresh ",-1)])]),_:1},8,["disabled"]),r(R,{type:"button",variant:"danger",class:"text-white fw-bold",icon:"fa-ban",disabled:a.value||!_.value,loading:g.value,onClick:y},{default:v(()=>[...b[1]||(b[1]=[U(" Kill Switch ",-1)])]),_:1},8,["disabled","loading"])])]),a.value?(d(),x(X,{key:0})):u.value?(d(),x(N,{key:1,message:u.value},null,8,["message"])):m.value.length?(d(),k("div",Va,[e("table",Ra,[b[3]||(b[3]=e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"text-white-50"},"Worker ID"),e("th",{scope:"col",class:"text-white-50"},"Status"),e("th",{scope:"col",class:"text-white-50"},"Claimed By"),e("th",{scope:"col",class:"text-white-50"},"Last Ping")])],-1)),e("tbody",null,[(d(!0),k(z,null,ie(m.value,S=>(d(),k("tr",{key:S.client_id},[e("td",Ia,A(S.client_id),1),e("td",null,[e("span",{class:D(["badge",S.online?"bg-success":"bg-secondary"])},A(S.online?"Online":"Offline"),3),S.claimed?(d(),k("span",Ma," Claimed ")):(d(),k("span",Ga,"Unclaimed"))]),e("td",Ta,A(S.linked_user||"—"),1),e("td",Da,A(n(S.last_ping_response)),1)]))),128))])])])):(d(),x(N,{key:2,message:"No workers found."}))]),_:1}))}}),Fa=B(qa,[["__scopeId","data-v-be8da67e"]]),Wa={class:"container-fluid px-0"},La={key:0,class:"text-center py-5"},Oa={key:1},Ka=T({__name:"SettingsPage",setup(i){const l=Ve(),t=Me(),a=Re(),g=ne(l,"suppressWorkerRedirect"),u=w(!0),m=q(()=>l.user?.username||""),_=q(()=>(l.user?.role||"").toUpperCase()),n=q(()=>t.versionLabel),c=q(()=>l.user?.email||""),y=q(()=>l.user?.guest_migration_status||""),p=q(()=>l.loading),b=q(()=>l.guestCredentials),S=q(()=>l.user?.username||""),L=C=>C?.role==="admin",I=q(()=>L(l.user)),F=q(()=>l.user?.is_guest),$=()=>window.location.assign("/settings"),o=()=>window.location.assign("/settings"),s=async()=>{l.suppressWorkerRedirect=!0;try{await l.logout()}catch{}finally{window.location.assign("/")}},f=async()=>{await t.loadVersion()};Ge({userRef:q(()=>l.user),suppressRedirectRef:g,getWsToken:()=>qe(),onWorkerUnavailable:()=>{window.location.assign("/worker-required")}});const E=async C=>a.createGame(C),P=async C=>{await a.updateAccount(C)},h=async()=>a.loadAdminSettings(),V=async C=>a.updateAdminSettings(C),Y=async()=>a.checkAdminSettingsHealth(),be=async(C,H)=>a.revealAdminSettings(C,H),ye=async(C,H)=>a.listUsers(C,H),we=async C=>a.resetUserPassword(C),he=async C=>a.deleteUser(C),ue=async C=>a.checkOperationStatus(C),_e=async()=>a.queueStats(),ke=async()=>a.cleanupQueue("all"),xe=async()=>a.listWorkers(),Se=async()=>a.unclaimAllWorkers(),$e=async C=>l.upgradeGuest(C),Ce=async()=>l.refreshUser(),Ae=()=>!!l.user?.is_guest,Ue=()=>{l.guestCredentials=null;try{window.sessionStorage.removeItem("savenload_guest_credentials")}catch{}try{window.localStorage.removeItem("savenload_guest_credentials")}catch{}};return K(async()=>{try{if(await l.refreshUser(),!l.user){window.location.assign("/login");return}}catch{window.location.assign("/login");return}finally{u.value=!1}}),(C,H)=>(d(),x(De,{"version-label":n.value,"on-logout":s,"on-load-version":f},{default:v(()=>[e("div",Wa,[r(Te,{title:"Settings","user-label":m.value,"user-role":_.value,onProfile:o,onSettings:$,onLogout:s},null,8,["user-label","user-role"]),u.value?(d(),k("div",La,[...H[0]||(H[0]=[e("div",{class:"spinner-border text-secondary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"text-white-50 mt-2 mb-0"},"Loading settings...",-1)])])):(d(),k("div",Oa,[I.value?(d(),x(ct,{key:0,"create-game":E})):M("",!0),I.value?(d(),x(Gt,{key:1,"load-settings":h,"update-settings":V,"check-health":Y,"reveal-settings":be})):M("",!0),I.value?(d(),x(Xt,{key:2,"list-users":ye,"reset-user-password":we,"delete-user":he,"check-operation-status":ue})):M("",!0),I.value?(d(),x(ra,{key:3,"load-queue-stats":_e,"clear-queue":ke})):M("",!0),I.value?(d(),x(Fa,{key:4,"list-workers":xe,"unclaim-all-workers":Se})):M("",!0),F.value?(d(),x(Ua,{key:5,"migration-status":y.value,"is-submitting":p.value,"guest-credentials":b.value,"current-username":S.value,"upgrade-guest":$e,"refresh-user":Ce,"check-operation-status":ue,"clear-guest-credentials":Ue,"get-is-guest":Ae},null,8,["migration-status","is-submitting","guest-credentials","current-username"])):M("",!0),F.value?M("",!0):(d(),x(pa,{key:6,email:c.value,"on-save":P},null,8,["email"]))]))]),I.value?(d(),x(ka,{key:0})):M("",!0)]),_:1},8,["version-label"]))}});Ie("settings",Ka);
