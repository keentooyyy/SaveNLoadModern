{% extends 'base.html' %}
{% load static %}

{% block title %}{% if is_user %}Dashboard{% else %}Admin Dashboard{% endif %}{% endblock %}

{% block content %}
<!-- Desktop Sidebar (Fixed) -->
<div class="d-none d-lg-block">
    {% include 'SaveNLoad/includes/sidebar.html' with is_user=is_user|default:False %}
</div>

<!-- Main Content -->
<div class="main-content">
    <div class="container-fluid px-0">
        {% include 'SaveNLoad/components/page_header.html' with page_title="Home" %}

        {% include 'SaveNLoad/includes/recent.html' %}
        {% include 'SaveNLoad/includes/available_games.html' with is_user=is_user|default:False %}
        {% include 'SaveNLoad/includes/manage_game_modal.html' with is_user=is_user|default:False %}
    </div>
</div>

<!-- Mobile Sidebar (Offcanvas) -->
<div class="d-lg-none">
    {% include 'SaveNLoad/includes/sidebar.html' with sidebar_id="sidebarMobile" is_user=is_user|default:False %}
</div>

<script>
    // Inject Django URLs for worker check


    // Inject Django URL patterns (with placeholder for game_id or operation_id)
    {% if is_user %}
    window.LIST_SAVE_FOLDERS_URL_PATTERN = '{% url "user:list_save_folders" 0 %}';
    window.LOAD_GAME_URL_PATTERN = '{% url "user:load_game" 0 %}';
    window.SAVE_GAME_URL_PATTERN = '{% url "user:save_game" 0 %}';
    window.CHECK_OPERATION_STATUS_URL_PATTERN = '{% url "user:check_operation_status" 0 %}';
    window.DELETE_SAVE_FOLDER_URL_PATTERN = '{% url "user:delete_save_folder" 0 0 %}';
    window.USER_SEARCH_GAMES_URL = '{% url "user:search_available_games" %}';
    window.IS_USER_VIEW = true;
    window.BACKUP_ALL_SAVES_URL_PATTERN = '{% url "user:backup_all_saves" 0 %}';
    window.DELETE_ALL_SAVES_URL_PATTERN = '{% url "user:delete_all_saves" 0 %}';
    window.GET_SAVE_LOCATION_URL_PATTERN = '{% url "user:get_game_save_location" 0 %}';
    window.OPEN_SAVE_LOCATION_URL_PATTERN = '{% url "user:open_save_location" 0 %}';
    {% else %}
    window.LIST_SAVE_FOLDERS_URL_PATTERN = '{% url "admin:list_save_folders" 0 %}';
    window.LOAD_GAME_URL_PATTERN = '{% url "admin:load_game" 0 %}';
    window.SAVE_GAME_URL_PATTERN = '{% url "admin:save_game" 0 %}';
    window.CHECK_OPERATION_STATUS_URL_PATTERN = '{% url "admin:check_operation_status" 0 %}';
    window.DELETE_SAVE_FOLDER_URL_PATTERN = '{% url "admin:delete_save_folder" 0 0 %}';
    window.ADMIN_SEARCH_GAMES_URL = '{% url "admin:search_available_games" %}';
    window.GAME_DETAIL_URL_PATTERN = '{% url "admin:game_detail" 0 %}';
    window.GAME_DELETE_URL_PATTERN = '{% url "admin:game_delete" 0 %}';
    window.BACKUP_ALL_SAVES_URL_PATTERN = '{% url "admin:backup_all_saves" 0 %}';
    window.DELETE_ALL_SAVES_URL_PATTERN = '{% url "admin:delete_all_saves" 0 %}';
    window.GET_SAVE_LOCATION_URL_PATTERN = '{% url "admin:get_game_save_location" 0 %}';
    window.OPEN_SAVE_LOCATION_URL_PATTERN = '{% url "admin:open_save_location" 0 %}';
    {% endif %}

    // Global game save paths mapping - accessible everywhere
    window.GAME_SAVE_PATHS = {
            {% for game in available_games %}
    "{{ game.id }}": {{ game.save_file_locations_json | safe }}{% if not forloop.last %},{% endif %}
    {% endfor %}
        };
</script>
<script>
    {% include 'SaveNLoad/js/gameFormUtils.js' %}

    {% include 'SaveNLoad/js/logoutHandler.js' %}
    {% include 'SaveNLoad/js/manageGames.js' %}
    {% include 'SaveNLoad/js/saveLoad.js' %}
    {% include 'SaveNLoad/js/availableGames.js' %}
</script>
{% endblock %}
