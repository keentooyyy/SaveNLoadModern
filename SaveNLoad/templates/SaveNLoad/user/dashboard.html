{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
    <!-- Desktop Sidebar (Fixed) -->
    <div class="d-none d-lg-block">
        {% include 'SaveNLoad/includes/sidebar.html' with is_user=True %}
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="container-fluid px-0">
            {% include 'SaveNLoad/includes/page_header.html' with page_title="Home" %}
            
            {% include 'SaveNLoad/includes/recent.html' %}
            {% include 'SaveNLoad/includes/available_games.html' with is_user=True %}
            {% include 'SaveNLoad/includes/manage_game_modal.html' with is_user=True %}
        </div>
    </div>
    
    <!-- Mobile Sidebar (Offcanvas) -->
    <div class="d-lg-none">
        {% include 'SaveNLoad/includes/sidebar.html' with sidebar_id="sidebarMobile" is_user=True %}
    </div>

    <script>
        // Inject Django URLs for worker check
        window.WORKER_CHECK_URL = '{% url "client_worker:check" %}';
        window.WORKER_REQUIRED_URL = '{% url "SaveNLoad:worker_required" %}';
        // Inject Django URL patterns (with placeholder for game_id or operation_id)
        // Use admin URLs for save/load operations (these work for both admin and users)
        window.LIST_SAVE_FOLDERS_URL_PATTERN = '{% url "admin:list_save_folders" 0 %}';
        window.LOAD_GAME_URL_PATTERN = '{% url "admin:load_game" 0 %}';
        window.SAVE_GAME_URL_PATTERN = '{% url "admin:save_game" 0 %}';
        window.CHECK_OPERATION_STATUS_URL_PATTERN = '{% url "admin:check_operation_status" 0 %}';
        window.DELETE_SAVE_FOLDER_URL_PATTERN = '{% url "admin:delete_save_folder" 0 0 %}';
        // Flag to indicate this is a user view
        window.IS_USER_VIEW = true;
        window.USER_SEARCH_GAMES_URL = '{% url "user:search_available_games" %}';
        window.BACKUP_ALL_SAVES_URL_PATTERN = '{% url "user:backup_all_saves" 0 %}';
        window.DELETE_ALL_SAVES_URL_PATTERN = '{% url "user:delete_all_saves" 0 %}';
        window.GET_SAVE_LOCATION_URL_PATTERN = '{% url "user:get_game_save_location" 0 %}';
        window.OPEN_SAVE_LOCATION_URL_PATTERN = '{% url "user:open_save_location" 0 %}';
        // Note: Users don't have game_detail or game_delete URLs
    </script>
    <script>
        {% include 'SaveNLoad/js/workerCheck.js' %}
        {% include 'SaveNLoad/js/manageGames.js' %}
        {% include 'SaveNLoad/js/saveLoad.js' %}
        {% include 'SaveNLoad/js/availableGames.js' %}
    </script>
{% endblock %}

